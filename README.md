# ã‚¯ãƒ­ã‚¹ãƒ† ï½Cross Stageï½

**éŸ³æ¥½ã¨èº«ä½“ãŒäº¤å·®ã™ã‚‹Webãƒªã‚ºãƒ ã‚²ãƒ¼ãƒ **

Cross Stage ã¯ã€TextAlive App API ã«ã‚ˆã‚‹æ­Œè©åŒæœŸæŠ€è¡“ã¨ MediaPipe (Pose / FaceMesh) ã«ã‚ˆã‚‹å‹•ä½œæ¤œçŸ¥AIã‚’èåˆã•ã›ãŸã€Webãƒªã‚ºãƒ ã‚²ãƒ¼ãƒ ã§ã™ã€‚
ãƒ©ã‚¤ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’èˆå°ã«ã€æµã‚Œã¦ãã‚‹æ­Œè©ã‚’ã€Œæ´ã¿ã€ã€Œå¥ã§ã‚‹ã€ã‚ˆã†ãªä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![React](https://img.shields.io/badge/React-18-61DAFB?logo=react&logoColor=black)
![TypeScript](https://img.shields.io/badge/TypeScript-5.5-3178C6?logo=typescript&logoColor=white)
![Vite](https://img.shields.io/badge/Vite-5-646CFF?logo=vite&logoColor=white)
![Hono](https://img.shields.io/badge/Hono-Workers-E36002?logo=hono&logoColor=white)
![Supabase](https://img.shields.io/badge/Supabase-PostgreSQL-3ECF8E?logo=supabase&logoColor=white)

---

## ğŸ® ã‚²ãƒ¼ãƒ æ¦‚è¦

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ©ã‚¤ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¸ã®è¦³å®¢ã€ã‚ã‚‹ã„ã¯æ¼”è€…ã¨ãªã‚Šã€æ¥½æ›²ã«åˆã‚ã›ã¦æµã‚Œã¦ãã‚‹ã€Œæ­Œè©ã€ã‚’ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚ˆãæ“ä½œã—ã¾ã™ã€‚å˜ãªã‚‹ã‚¿ãƒƒãƒ—ã§ã¯ãªãã€**ã€Œãƒ›ãƒ¼ãƒ«ãƒ‰ï¼ˆé•·æŠ¼ã—ï¼‰ã€**ã™ã‚‹ã“ã¨ã§ã‚²ãƒ¼ã‚¸ã‚’æºœã‚ã€ã‚¹ã‚³ã‚¢ã‚’ç¨¼ãç‹¬è‡ªã®ãƒªã‚ºãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
ãƒ—ãƒ¬ã‚¤çµæœã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚

### Immersive Live Experience
- **ãƒã‚ªãƒ³Ã—ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ **: ãƒã‚ªãƒ³ãƒ©ã‚¤ãƒˆã¨é€ãé€šã‚‹ã‚ˆã†ãªUIãƒ‡ã‚¶ã‚¤ãƒ³ã€‚
- **3Dã‚¹ãƒ†ãƒ¼ã‚¸æ¼”å‡º**: Three.js ã¨ CSS Animation ã‚’çµ„ã¿åˆã‚ã›ãŸã€è»½é‡ãªãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°æ¼”å‡ºã€‚
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: PCã®å¤§ç”»é¢ã‹ã‚‰ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒ—ãƒ¬ã‚¤ã¾ã§ã€ãƒ‡ãƒã‚¤ã‚¹ã«å¯¾å¿œã—ãŸUIã€‚

---

## ğŸ•¹ï¸ ãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰

ãƒ‡ãƒã‚¤ã‚¹ã‚„ç’°å¢ƒã«åˆã‚ã›ã¦ã€4ã¤ã®æ“ä½œãƒ¢ãƒ¼ãƒ‰ã‚’æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

| ãƒ¢ãƒ¼ãƒ‰ | å¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹ | æ“ä½œæ–¹æ³• | ç‰¹å¾´ |
| :--- | :--- | :--- | :--- |
| **Cursor Mode** | PC / ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ | ãƒã‚¦ã‚¹ / ã‚¿ãƒƒãƒ | ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚„ã‚¿ãƒƒãƒæ“ä½œã§æ­Œè©ã‚’ãƒ›ãƒ¼ãƒ«ãƒ‰ã€‚æ‰‹è»½ã«æ¥½ã—ã‚ã‚‹åŸºæœ¬ãƒ¢ãƒ¼ãƒ‰ã€‚ |
| **Mobile Mode** | ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ | ã‚¿ãƒƒãƒ— & ãƒ›ãƒ¼ãƒ«ãƒ‰ | ã‚¹ãƒãƒ›æ“ä½œã«ç‰¹åŒ–ã€‚ç”»é¢ä¸‹éƒ¨ã®æ­Œè©è¡¨ç¤ºã‚’æ’é™¤ã—ã€ãƒ—ãƒ¬ã‚¤é ˜åŸŸã‚’æœ€å¤§åŒ–ã€‚è¦ªæŒ‡ä¸€ã¤ã§éŠã¹ã‚‹ç›´æ„Ÿçš„ãªæ“ä½œæ„Ÿã€‚ |
| **Body Mode** | PC (Webã‚«ãƒ¡ãƒ©) | å…¨èº«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | Webã‚«ãƒ¡ãƒ©ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹•ãã‚’æ¤œçŸ¥ã€‚æ‰‹ã‚„ä½“ã‚’æ­Œè©ã«é‡ã­ã¦ã€Œè§¦ã‚Œã‚‹ã€ã“ã¨ã§å…¥åŠ›ã™ã‚‹ã€å…¨èº«ã‚’ä½¿ã£ãŸãƒ¢ãƒ¼ãƒ‰ã€‚ |
| **Face Mode** | ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ / PC (ã‚«ãƒ¡ãƒ©ä»˜) | é¡”ç§»å‹• & å£ãƒ‘ã‚¯ | ã‚«ãƒ¡ãƒ©ã§é¡”ã‚’èªè­˜ã€‚é¡”ã‚’å‹•ã‹ã—ã¦ä½ç½®ã‚’åˆã‚ã›ã€å£ã‚’ã€Œãƒ‘ã‚¯ãƒƒã€ã¨é–‹ã‘ã‚‹ã“ã¨ã§æ­Œè©ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã€‚ |

---

## ğŸš€ æŠ€è¡“çš„ãªç‰¹å¾´

### Frontend (Modern Web)
- **React 18 & Vite**: é«˜é€Ÿãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨é–‹ç™ºä½“é¨“ã€‚
- **Architecture**: `GameManager` ã‚’ä¸­å¿ƒã¨ã—ãŸå³æ ¼ãªè²¬å‹™åˆ†é›¢ï¼ˆSRPï¼‰ã€‚ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã€å…¥åŠ›å‡¦ç†ã€æç”»ã€éŸ³å£°åŒæœŸã‚’ç‹¬ç«‹ç®¡ç†ã€‚
- **Performance**: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚„ãƒãƒ–ãƒ«ã®æç”»ã« `will-change` æœ€é©åŒ–ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒªãƒ³ã‚°ã‚’æ¡ç”¨ã—ã€Webãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§æ»‘ã‚‰ã‹ãª60fpså‹•ä½œã‚’å®Ÿç¾ã€‚

### Backend (Robust & Secure)
- **Cloudflare Workers & Hono**: ã‚¨ãƒƒã‚¸ã§ã®é«˜é€ŸãªAPIå‡¦ç†ã€‚
- **Supabase (PostgreSQL)**: RLS (Row Level Security) ã‚’æ´»ç”¨ã—ãŸå …ç‰¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€‚
- **Security First**:
  - **Turnstile**: Cloudflareã®ã‚¹ãƒãƒ¼ãƒˆCAPTCHAã«ã‚ˆã‚‹ãƒœãƒƒãƒˆæ’é™¤ã€‚
  - **HMACç½²å**: ã‚¹ã‚³ã‚¢é€ä¿¡æ™‚ã®æ”¹ã–ã‚“é˜²æ­¢ã€‚
  - **Idempotency**: å†ªç­‰æ€§ã‚’æ‹…ä¿ã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸å®‰å®šæ™‚ã®äºŒé‡æŠ•ç¨¿ã‚’é˜²æ­¢ã€‚

---

## ğŸ› ï¸ ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜è©³ç´°

### 1. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```mermaid
classDiagram
  class App
  class IndexPage
  class GamePage
  class RankingModal
  class RankingPanel
  class ModeTabs
  class Slot

  class GameManager {
    +playMusic()
    +togglePlay()
    +restartGame()
    +showResults()
  }
  class GameLoop {
    +start()
    +stop()
  }
  class TimerManager {
    +setTimeout()
    +setInterval()
    +clearTimer()
    +clearAll()
  }
  class BubblePool {
    +acquire()
    +release()
    +releaseAll()
  }
  class LyricsRenderer
  class InputManager {
    +setupEvents()
  }
  class UIManager {
    +updateInstructions()
  }
  class EffectsManager {
    +createClickEffect()
  }
  class ResultsManager {
    +showResults()
  }
  class FaceDetectionManager {
    +init()
  }
  class BodyDetectionManager {
    +isReady()
    +isCountdownActive()
  }
  class ViewportManager {
    +updateViewportHeight()
  }
  class LiveStageVisuals

  class WorkerIndexApp
  class WorkerScoreRoute
  class WorkerAdminRoute
  class RequestIdMiddleware
  class SessionMiddleware
  class AdminAuthMiddleware
  class RateLimiter
  class WorkerSupabaseClient

  class ServerIndexApp
  class ServerScoreRoute
  class ServerSupabaseClient

  App --> IndexPage : route
  App --> GamePage : route
  GamePage --> GameManager : owns
  GamePage --> RankingModal : uses
  GamePage --> RankingPanel : uses
  GamePage --> ModeTabs : uses
  GamePage --> Slot : uses
  RankingModal --> RankingPanel : contains

  GameManager --> GameLoop : frame loop
  GameManager --> TimerManager : timeouts/intervals
  GameManager --> BubblePool : lyric bubble reuse
  GameManager --> LyricsRenderer : spawn/animate lyrics
  GameManager --> InputManager : pointer/gesture
  GameManager --> UIManager : HUD updates
  GameManager --> EffectsManager : particles
  GameManager --> ResultsManager : result flow
  GameManager --> ViewportManager : resize
  GameManager --> FaceDetectionManager : face mode
  GameManager --> BodyDetectionManager : body mode
  GameManager --> LiveStageVisuals : 3D stage
  GameManager ..> WorkerIndexApp : HTTP /api/*
  GameManager ..> ServerIndexApp : HTTP /api/* (dev)
  BodyDetectionManager --> TimerManager : countdown timers

  WorkerIndexApp --> WorkerScoreRoute : /api/score
  WorkerIndexApp --> WorkerAdminRoute : /admin/scores
  WorkerIndexApp --> RequestIdMiddleware : requestId
  WorkerIndexApp --> SessionMiddleware : sessionId
  WorkerAdminRoute --> AdminAuthMiddleware : adminAuth
  WorkerScoreRoute --> RateLimiter : IP/nonce
  WorkerScoreRoute --> WorkerSupabaseClient : insert scores
  WorkerAdminRoute --> WorkerSupabaseClient : delete scores
  WorkerIndexApp --> WorkerSupabaseClient : client init

  ServerIndexApp --> ServerScoreRoute : /api/*
  ServerScoreRoute --> ServerSupabaseClient : insert/query
```

### 2. æ©Ÿèƒ½éšå±¤å›³
```mermaid
graph TD
  A[Cross Stage]
  A --> B[ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤]
  B --> B1[ãƒ¢ãƒ¼ãƒ‰ç®¡ç†: cursor/body/mobile/face]
  B --> B2[æ­Œè©åŒæœŸ/TextAlive]
  B --> B3[åˆ¤å®š/ã‚¹ã‚³ã‚¢/ã‚³ãƒ³ãƒœ]
  B --> B4[ãƒ›ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚³ã‚¢]
  B --> B5[çµæœ/ãƒªã‚¶ãƒ«ãƒˆ]
  A --> C[ã‚«ãƒ¡ãƒ©/å…¥åŠ›]
  C --> C1[Poseæ¤œå‡º]
  C --> C2[Faceæ¤œå‡º]
  C --> C3[äººç‰©æŠ½å‡º]
  C --> C4[è­¦å‘Š/è£œåŠ©UI]
  A --> D[UI/æ¼”å‡º]
  D --> D1[æ­Œè©ãƒãƒ–ãƒ«]
  D --> D2[ã‚¹ã‚³ã‚¢/ã‚³ãƒ³ãƒœHUD]
  D --> D3[ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«/3Dæ¼”å‡º]
  A --> E[ãƒ©ãƒ³ã‚­ãƒ³ã‚°]
  E --> E1[ã‚¹ã‚³ã‚¢ç™»éŒ²]
  E --> E2[ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—]
  E --> E3[ãƒ©ãƒ³ã‚­ãƒ³ã‚°UI]
  A --> F[ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰]
  F --> F1[API/æ¤œè¨¼]
  F --> F2[ãƒ¬ãƒ¼ãƒˆåˆ¶é™]
  F --> F3[ç®¡ç†API]
  A --> G[ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢]
  G --> G1[(scores)]
```

### 3. ä¸»è¦æ©Ÿèƒ½ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ (IPOå›³)
```mermaid
flowchart TB
  subgraph Gameplay[ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤/ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°]
    GP_In[Input: TextAliveã‚¿ã‚¤ãƒŸãƒ³ã‚°, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›, ã‚«ãƒ¡ãƒ©Landmarks]
    GP_Proc[Process: ãƒãƒ–ãƒ«ç”Ÿæˆ, ãƒ’ãƒƒãƒˆ/ãƒ›ãƒ¼ãƒ«ãƒ‰åˆ¤å®š, ã‚³ãƒ³ãƒœ/ã‚¹ã‚³ã‚¢è¨ˆç®—]
    GP_Out[Output: ã‚¹ã‚³ã‚¢UI, æ¼”å‡º, ãƒªã‚¶ãƒ«ãƒˆ]
    GP_In --> GP_Proc --> GP_Out
  end

  subgraph Camera[ã‚«ãƒ¡ãƒ©èªè­˜]
    C_In[Input: Webã‚«ãƒ¡ãƒ©æ˜ åƒ]
    C_Proc[Process: Pose/FaceMesh/Segmentation, å“è³ª/è² è·åˆ¶å¾¡]
    C_Out[Output: ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯/äººä½“ãƒã‚¹ã‚¯/åˆ¤å®šã‚¤ãƒ™ãƒ³ãƒˆ]
    C_In --> C_Proc --> C_Out
  end

  subgraph ScoreSubmit[ã‚¹ã‚³ã‚¢ç™»éŒ²]
    S_In[Input: GameResult, x-score-token?, turnstileToken?]
    S_Proc[Process: Origin/Rate limit/HMAC/Turnstileæ¤œè¨¼, SupabaseæŒ¿å…¥]
    S_Out[Output: ä¿å­˜çµæœ/ã‚¨ãƒ©ãƒ¼]
    S_In --> S_Proc --> S_Out
  end
```

### 4. ç”»é¢é·ç§»å›³
```mermaid
stateDiagram-v2
  state "ã‚¿ã‚¤ãƒˆãƒ«/æ›²é¸æŠ" as Index
  state "ã‚²ãƒ¼ãƒ " as Game
  state "ãƒªã‚¶ãƒ«ãƒˆ" as Results
  state "ãƒ©ãƒ³ã‚­ãƒ³ã‚°(ãƒ¢ãƒ¼ãƒ€ãƒ«)" as Ranking
  state "çµ‚äº†ç¢ºèª(ãƒ¢ãƒ¼ãƒ€ãƒ«)" as ExitConfirm

  [*] --> Index
  Index --> Game: ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
  Index --> Ranking: ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
  Ranking --> Index: é–‰ã˜ã‚‹
  Game --> Results: æ›²çµ‚äº†/å¼·åˆ¶çµ‚äº†
  Results --> Game: ã‚‚ã†ä¸€åº¦
  Results --> Index: ã‚¿ã‚¤ãƒˆãƒ«ã¸
  Game --> Ranking: ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
  Ranking --> Game: é–‰ã˜ã‚‹
  Game --> ExitConfirm: æˆ»ã‚‹/ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯
  ExitConfirm --> Game: ç¶šã‘ã‚‹
  ExitConfirm --> Index: çµ‚äº†
```

### 5. è¦ä»¶å®šç¾© (ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—)
```mermaid
mindmap
  root((Cross Stage))
    æ©Ÿèƒ½è¦ä»¶
      ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤
        ãƒªã‚ºãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          ã‚¿ãƒƒãƒ—åˆ¤å®š
          ãƒ›ãƒ¼ãƒ«ãƒ‰åˆ¤å®š
          ã‚³ãƒ³ãƒœã‚·ã‚¹ãƒ†ãƒ 
        æ¼”å‡º
          æ­Œè©ãƒãƒ–ãƒ«
          3DèƒŒæ™¯
          ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
      ãƒ¢ãƒ¼ãƒ‰
        Cursor Mode PC/Touch
        Mobile Mode SP
        Body Mode å…¨èº«æ¤œçŸ¥
        Face Mode é¡”æ¤œçŸ¥
      å¤–éƒ¨é€£æº
        TextAlive æ­Œè©åŒæœŸ
        MediaPipe èº«ä½“èªè­˜
      ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ©ãƒ³ã‚­ãƒ³ã‚°
        ã‚¹ã‚³ã‚¢ç™»éŒ²API
    éæ©Ÿèƒ½è¦ä»¶
      ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
        ä½é…å»¶å‡¦ç†
        SPAé·ç§»
      ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
        Botå¯¾ç­– Turnstile
        æ”¹ã–ã‚“é˜²æ­¢ HMAC
        ãƒ¬ãƒ¼ãƒˆåˆ¶é™
      ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£
        ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–
        ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
```

### 6. é–‹ç™ºã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« (ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ)
```mermaid
gantt
    title Cross Stage é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— (2025/10 - 2026/01)
    dateFormat  YYYY-MM-DD
    axisFormat %m/%d
    
    section ä¼ç”»ãƒ»è¦ä»¶å®šç¾©
    ä¼ç”»               :done, a1, 2025-10-01, 14d
    è¦ä»¶å®šç¾©           :done, a2, after a1, 14d
    ãƒ‡ã‚¶ã‚¤ãƒ³           :done, a3, after a1, 20d
    
    section é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º(Core)
    ã‚²ãƒ¼ãƒ æ©Ÿèƒ½       :done, b1, 2025-11-01, 20d
    æ­Œè©åŒæœŸ           :done, b2, after b1, 12d
    åŸºæœ¬ãƒ¢ãƒ¼ãƒ‰         :done, b3, after b2, 12d
    
    section é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º(Adv)
    ã‚«ãƒ¡ãƒ©æ¤œçŸ¥         :done, c1, after b3, 20d
    APIæ§‹ç¯‰            :done, c2, after b3, 14d
    ãƒ©ãƒ³ã‚­ãƒ³ã‚°         :done, c3, after c2, 10d
    
    section ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´
    æ¼”å‡º               :done, d1, 2026-01-08, 3d
    ãƒ†ã‚¹ãƒˆ             :done, d2, after d1, 5d
    å…¬é–‹               :done, d3, after d2, 4d
```

### 7. APIä»•æ§˜

**APIä¸€è¦§**
| Method | Path | æ¦‚è¦ | èªè¨¼/æ¡ä»¶ |
| --- | --- | --- | --- |
| GET | /api/health | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | ãªã— |
| GET | /api/config | Turnstile Site Key å–å¾— | ãªã— |
| GET | /api/token | ã‚¹ã‚³ã‚¢ç½²åãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ | SCORE_SIGNING_SECRET è¨­å®šæ™‚ã®ã¿æœ‰åŠ¹ |
| POST | /api/score | ã‚¹ã‚³ã‚¢ç™»éŒ² | FRONTEND_ORIGIN/Rate limit/HMAC/Turnstile (æ¡ä»¶ä»˜ã) |
| GET | /api/ranking | ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾— | songId å¿…é ˆ |
| DELETE | /admin/scores | ã‚¹ã‚³ã‚¢å‰Šé™¤ | x-admin-token å¿…é ˆ |

**ã‚¹ã‚³ã‚¢ç™»éŒ²ãƒ•ãƒ­ãƒ¼**
```mermaid
flowchart TD
  A[ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã§ç™»éŒ²] --> B[Client: POST /api/score]
  B --> C{Origin OK?}
  C -- No --> E[403 Forbidden]
  C -- Yes --> D[Rate limit check]
  D -- Exceed --> E2[429 Too Many Requests]
  D -- OK --> F{SCORE_SIGNING_SECRET?}
  F -- Yes --> G[HMAC token verify + nonce]
  G -- Fail --> E3[401/403/409]
  G -- OK --> H{Turnstile enabled?}
  F -- No --> H
  H -- Yes --> I[Turnstile verify]
  I -- Fail --> E4[403 Invalid Token]
  H -- No --> J[Supabase insert]
  I -- OK --> J
  J --> K{DB OK?}
  K -- No --> E5[500 DB Error]
  K -- Yes --> L[200 OK]
```

---

## ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ERå›³ï¼ˆå˜ä¸€ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
```mermaid
erDiagram
  SCORES {
    uuid id PK
    text session_id
    text song_id
    text mode
    int score
    int max_combo
    text rank
    numeric accuracy
    boolean is_suspicious
    text player_name
    timestamptz created_at
  }
```

### ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© (scores)
| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
| --- | --- | --- |
| id | uuid | ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ |
| session_id | text | åŒ¿åã‚»ãƒƒã‚·ãƒ§ãƒ³ID |
| song_id | text | æ¥½æ›²ID |
| mode | text | cursor/body/mobile/face |
| score | integer | ã‚¹ã‚³ã‚¢ |
| max_combo | integer | æœ€å¤§ã‚³ãƒ³ãƒœ |
| rank | text | ãƒ©ãƒ³ã‚¯ |
| accuracy | numeric | ç²¾åº¦(%) |
| is_suspicious | boolean | ãƒãƒ¼ãƒˆç–‘ã„ãƒ•ãƒ©ã‚° |
| player_name | text | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å |
| created_at | timestamptz | ç™»éŒ²æ—¥æ™‚ |

---

## ğŸ§© ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²å›³
```mermaid
graph TD
  subgraph Frontend
    UI[Pages/Components]
    Core[Game Core]
    Input[Input/Camera]
    Visuals[Effects/3D]
  end
  subgraph Backend
    Worker[Workers API]
    Rate[RateLimiter DO]
  end
  DB[(Supabase)]

  UI --> Core
  Core --> Input
  Core --> Visuals
  Core --> Worker
  Worker --> Rate
  Worker --> DB
```

### ä¸»è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è²¬å‹™
| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | è²¬å‹™ | ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ« |
| --- | --- | --- |
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°/ãƒšãƒ¼ã‚¸ | SPAãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ç”»é¢é·ç§» | src/App.tsx, src/pages/IndexPage.tsx, src/pages/GamePage.tsx |
| UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºã€ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ | src/components/game/RankingModal.tsx, src/components/game/ModeTabs.tsx |
| ã‚²ãƒ¼ãƒ ã‚³ã‚¢ | ã‚²ãƒ¼ãƒ é€²è¡Œã€ã‚¹ã‚³ã‚¢ã€ãƒªã‚¶ãƒ«ãƒˆ | src/game/GameManager.ts, src/game/GameLoop.ts |
| æ­Œè©æç”» | ãƒãƒ–ãƒ«ç”Ÿæˆã€è¡¨ç¤ºã€åˆ¤å®šè£œåŠ© | src/game/GameManager.ts (LyricsRenderer) |
| å…¥åŠ›/ã‚«ãƒ¡ãƒ© | ãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒ/ã‚«ãƒ¡ãƒ©å…¥åŠ›ã€Pose/Face åˆ¤å®š | src/game/GameManager.ts (InputManager, Detectors) |
| Workers API | ã‚¹ã‚³ã‚¢ç™»éŒ²/ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—/ç®¡ç† | worker/index.ts, worker/routes/score.ts |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | Durable Object ã«ã‚ˆã‚‹åˆ¶é™/Nonce | worker/rateLimiter.ts |

### ã‚¯ãƒ©ã‚¹å›³
```mermaid
classDiagram
  class App
  class IndexPage
  class GamePage
  class RankingModal
  class RankingPanel
  class ModeTabs
  class Slot

  class GameManager {
    +playMusic()
    +togglePlay()
    +restartGame()
    +showResults()
  }
  class GameLoop {
    +start()
    +stop()
  }
  class TimerManager {
    +setTimeout()
    +setInterval()
    +clearTimer()
    +clearAll()
  }
  class BubblePool {
    +acquire()
    +release()
    +releaseAll()
  }
  class LyricsRenderer
  class InputManager {
    +setupEvents()
  }
  class UIManager {
    +updateInstructions()
  }
  class EffectsManager {
    +createClickEffect()
  }
  class ResultsManager {
    +showResults()
  }
  class FaceDetectionManager {
    +init()
  }
  class BodyDetectionManager {
    +isReady()
    +isCountdownActive()
  }
  class ViewportManager {
    +updateViewportHeight()
  }
  class LiveStageVisuals

  class ScoreService
  class TokenService

  class WorkerIndexApp
  class WorkerScoreRoute
  class WorkerAdminRoute
  class WorkerScoreService
  class WorkerAdminService
  class WorkerScoreSchemas
  class RequestIdMiddleware
  class SessionMiddleware
  class AdminAuthMiddleware
  class RateLimiter
  class WorkerSupabaseClient

  class ServerIndexApp
  class ServerScoreRoute
  class ServerScoreService
  class ServerRateLimiter
  class ServerRankingCache
  class ServerScoreValidation
  class ServerSupabaseClient

  App --> IndexPage : route
  App --> GamePage : route
  GamePage --> GameManager : owns
  GamePage --> RankingModal : uses
  GamePage --> RankingPanel : uses
  GamePage --> ModeTabs : uses
  GamePage --> Slot : uses
  GamePage --> ScoreService : submit score
  GamePage --> TokenService : fetch token
  RankingModal --> RankingPanel : contains

  GameManager --> GameLoop : frame loop
  GameManager --> TimerManager : timeouts/intervals
  GameManager --> BubblePool : lyric bubble reuse
  GameManager --> LyricsRenderer : spawn/animate lyrics
  GameManager --> InputManager : pointer/gesture
  GameManager --> UIManager : HUD updates
  GameManager --> EffectsManager : particles
  GameManager --> ResultsManager : result flow
  GameManager --> ViewportManager : resize
  GameManager --> FaceDetectionManager : face mode
  GameManager --> BodyDetectionManager : body mode
  GameManager --> LiveStageVisuals : 3D stage
  BodyDetectionManager --> TimerManager : countdown timers

  ScoreService ..> WorkerIndexApp : HTTP /api/score
  ScoreService ..> ServerIndexApp : HTTP /api/score (dev)
  TokenService ..> WorkerIndexApp : HTTP /api/token
  TokenService ..> ServerIndexApp : HTTP /api/token (dev)

  WorkerIndexApp --> WorkerScoreRoute : /api/score
  WorkerIndexApp --> WorkerAdminRoute : /admin/scores
  WorkerIndexApp --> RequestIdMiddleware : requestId
  WorkerIndexApp --> SessionMiddleware : sessionId
  WorkerAdminRoute --> AdminAuthMiddleware : adminAuth
  WorkerScoreRoute --> WorkerScoreSchemas : validate
  WorkerScoreRoute --> WorkerScoreService : handle
  WorkerAdminRoute --> WorkerAdminService : handle
  WorkerScoreService --> RateLimiter : IP/nonce
  WorkerScoreService --> WorkerSupabaseClient : insert/select
  WorkerAdminService --> WorkerSupabaseClient : delete
  WorkerIndexApp --> WorkerSupabaseClient : client init

  ServerIndexApp --> ServerScoreRoute : /api/*
  ServerScoreRoute --> ServerRateLimiter : rate limit
  ServerScoreRoute --> ServerScoreValidation : validate
  ServerScoreRoute --> ServerRankingCache : cache
  ServerScoreRoute --> ServerScoreService : persist/query
  ServerScoreService --> ServerSupabaseClient : db

  note for App "src/App.tsx"
  note for IndexPage "src/pages/IndexPage.tsx"
  note for GamePage "src/pages/GamePage.tsx"
  note for RankingModal "src/components/game/RankingModal.tsx"
  note for RankingPanel "src/components/game/RankingPanel.tsx"
  note for ModeTabs "src/components/game/ModeTabs.tsx"
  note for Slot "src/components/game/Slot.tsx"
  note for ScoreService "src/services/scoreService.ts"
  note for TokenService "src/services/tokenService.ts"

  note for GameManager "src/game/GameManager.ts"
  note for GameLoop "src/game/GameLoop.ts"
  note for TimerManager "src/game/TimerManager.ts"
  note for BubblePool "src/game/BubblePool.ts"
  note for LyricsRenderer "src/game/managers/LyricsRenderer.ts"
  note for InputManager "src/game/managers/InputManager.ts"
  note for UIManager "src/game/managers/UIManager.ts"
  note for EffectsManager "src/game/managers/EffectsManager.ts"
  note for ResultsManager "src/game/managers/ResultsManager.ts"
  note for FaceDetectionManager "src/game/managers/FaceDetectionManager.ts"
  note for BodyDetectionManager "src/game/managers/BodyDetectionManager.ts"
  note for ViewportManager "src/game/managers/ViewportManager.ts"
  note for LiveStageVisuals "src/game/managers/LiveStageVisuals.ts"

  note for WorkerIndexApp "worker/index.ts"
  note for WorkerScoreRoute "worker/routes/score.ts"
  note for WorkerAdminRoute "worker/routes/admin.ts"
  note for WorkerScoreService "worker/services/scoreService.ts"
  note for WorkerAdminService "worker/services/adminService.ts"
  note for WorkerScoreSchemas "worker/schemas/scoreSchemas.ts"
  note for RequestIdMiddleware "worker/middleware/requestId.ts"
  note for SessionMiddleware "worker/middleware/session.ts"
  note for AdminAuthMiddleware "worker/middleware/admin.ts"
  note for RateLimiter "worker/rateLimiter.ts"
  note for WorkerSupabaseClient "worker/supabaseClient.ts"

  note for ServerIndexApp "server/index.ts"
  note for ServerScoreRoute "server/routes/score.ts"
  note for ServerScoreService "server/services/scoreService.ts"
  note for ServerRateLimiter "server/services/rateLimiter.ts"
  note for ServerRankingCache "server/services/rankingCache.ts"
  note for ServerScoreValidation "server/services/scoreValidation.ts"
  note for ServerSupabaseClient "server/supabaseClient.ts"
```

---

## ğŸ“¦ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```bash
star/
â”œâ”€â”€ src/                  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ components/       # React UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (Ranking, Modalç­‰)
â”‚   â”œâ”€â”€ game/             # ã‚²ãƒ¼ãƒ ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ GameManager.ts # ã‚²ãƒ¼ãƒ é€²è¡Œç®¡ç†
â”‚   â”‚   â”œâ”€â”€ GameLoop.ts    # ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
â”‚   â”‚   â””â”€â”€ ...           
â”‚   â”œâ”€â”€ pages/            # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ (Index, Game)
â”‚   â””â”€â”€ styles.css        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©
â””â”€â”€ worker/               # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»API (Cloudflare Workers)
    â”œâ”€â”€ index.ts          # Hono ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    â”œâ”€â”€ rateLimiter.ts    # ãƒ¬ãƒ¼ãƒˆåˆ¶é™ (Durable Object)
    â””â”€â”€ ...
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£è¦–ç‚¹ï¼‰

### çµåˆãƒ†ã‚¹ãƒˆ 
| ID | ã‚·ãƒ¼ãƒ³ | æ‰‹é †/å…¥åŠ› | æœŸå¾…çµæœï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ï¼‰ |
| --- | --- | --- | --- |
| 01 | ã‚¿ã‚¤ãƒˆãƒ«å°ç·š | ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ | é¸æŠä¸­ã®ãƒ¢ãƒ¼ãƒ‰ãŒè¦–è¦šçš„ã«å¼·èª¿ã•ã‚Œã€èª¬æ˜æ–‡ã‚‚å³æ™‚ã«æ›´æ–°ã•ã‚Œã‚‹ |
| 02 | éŠã³æ–¹ãƒ¢ãƒ¼ãƒ€ãƒ« | ã€ŒéŠã³æ–¹ã€ã‚’é–‹ãâ†’é–‰ã˜ã‚‹ | å†…å®¹ãŒèª­ã¿ã‚„ã™ãè¡¨ç¤ºã•ã‚Œã€é–‰ã˜ã‚‹æ“ä½œã§å…ƒç”»é¢ã«æˆ»ã‚‹ |
| 03 | ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ« | ã€Œãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€â†’æœŸé–“/ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿â†’é–‰ã˜ã‚‹ | ä¸€è¦§ãŒæ›´æ–°ã•ã‚Œã€é–‰ã˜ã‚‹ã¨å…ƒã®ç”»é¢ã¸æˆ»ã‚Œã‚‹ |
| 04 | ã‚²ãƒ¼ãƒ é–‹å§‹ | ã€Œã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã€â†’ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾…ã¡ | ãƒ­ãƒ¼ãƒ‰ä¸­è¡¨ç¤ºãŒã‚ã‚Šã€å†ç”Ÿ/ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãŒç„¡åŠ¹â†’æº–å‚™å®Œäº†ã§æœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ |
| 05 | å†ç”Ÿ/ä¸€æ™‚åœæ­¢ | å†ç”Ÿâ†’ä¸€æ™‚åœæ­¢â†’å†ç”Ÿ | ãƒœã‚¿ãƒ³è¡¨è¨˜ãŒçŠ¶æ…‹ã«ä¸€è‡´ã—ã€æ­Œè©/ã‚¹ã‚³ã‚¢æ›´æ–°ãŒåœæ­¢/å†é–‹ã™ã‚‹ |
| 06 | ãƒã‚¦ã‚¹æ“ä½œ | ãƒãƒ–ãƒ«ã‚’é•·æŠ¼ã— | é€²æ—è¡¨ç¤ºãŒå‡ºã¦ã‚¹ã‚³ã‚¢/ã‚³ãƒ³ãƒœãŒåŠ ç®—ã•ã‚Œã€é›¢ã™ã¨è§£é™¤ã•ã‚Œã‚‹ |
| 07 | ãƒ¢ãƒã‚¤ãƒ«æ“ä½œ | ã‚¿ãƒƒãƒ—ã§é•·æŠ¼ã— | æŒ‡æ“ä½œã§ã‚‚ãƒ›ãƒ¼ãƒ«ãƒ‰ã§ãã€èª¤æ“ä½œãŒèµ·ãã«ãã„ |
| 08 | ãƒœãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ | å…¨èº«ãŒæ˜ ã‚‹â†’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å®Œäº† | èª¿æ•´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸â†’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³â†’å†ç”Ÿé–‹å§‹ã®é †ã§è¡¨ç¤ºã•ã‚Œã‚‹ |
| 09 | ãƒœãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰è­¦å‘Š | å†ç”Ÿä¸­ã«å…¨èº«ãŒå¤–ã‚Œã‚‹ | ä¸€å®šæ™‚é–“å¾Œã«è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã€å¾©å¸°ã§è­¦å‘ŠãŒæ¶ˆãˆã‚‹ |
| 10 | ãƒ•ã‚§ã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ | å£ã‚’é–‹ã/é–‰ã˜ã‚‹ | é–‹å£æ™‚ã®ã¿ãƒ›ãƒ¼ãƒ«ãƒ‰åˆ¤å®šã€é–‰å£ã§è§£é™¤ã•ã‚Œã‚‹ |
| 11 | ãƒªã‚¶ãƒ«ãƒˆè¡¨ç¤º | æ›²çµ‚äº† | ãƒªã‚¶ãƒ«ãƒˆç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã€ã‚¹ã‚³ã‚¢/æœ€å¤§ã‚³ãƒ³ãƒœ/ãƒ©ãƒ³ã‚¯/åå‰å…¥åŠ›ãŒè¦–èªã§ãã‚‹ |
| 12 | ã‚¹ã‚³ã‚¢ç™»éŒ²æˆåŠŸ | åå‰å…¥åŠ›â†’ç™»éŒ² | ã€Œç™»éŒ²å®Œäº†ã€ã«å¤‰ã‚ã‚Šã€ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ |
| 13 | ã‚¹ã‚³ã‚¢ç™»éŒ²å¤±æ•— | é€šä¿¡å¤±æ•—ã‚’æ¨¡æ“¬â†’ç™»éŒ² | ã€Œç™»éŒ²å¤±æ•—(å†è©¦è¡Œ)ã€ã«å¤‰ã‚ã‚Šã€å†è©¦è¡ŒãŒå¯èƒ½ã«ãªã‚‹ |
| 14 | æœªç™»éŒ²ã®é›¢è„± | ç™»éŒ²ã›ãšã«ã‚¿ã‚¤ãƒˆãƒ«/ãƒªãƒˆãƒ©ã‚¤ | ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã€ç¶šã‘ã‚‹/çµ‚äº†ã™ã‚‹ã‚’é¸ã¹ã‚‹ |
| 15 | ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç©ºè¡¨ç¤º | ã‚¹ã‚³ã‚¢ãªã—ã®æ›²ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º | ã€Œã¾ã ã‚¹ã‚³ã‚¢ãŒã‚ã‚Šã¾ã›ã‚“ã€ç­‰ã®æ¡ˆå†…ãŒå‡ºã‚‹ |
| 16 | ãƒ©ãƒ³ã‚­ãƒ³ã‚°é€šä¿¡å¤±æ•— | /api/ranking å¤±æ•— | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã€ç”»é¢ãŒãƒ•ãƒªãƒ¼ã‚ºã—ãªã„ |

### å˜ä½“ãƒ†ã‚¹ãƒˆ 
| ID | å¯¾è±¡ | æ¡ä»¶/å…¥åŠ› | æœŸå¾…çµæœï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ï¼‰ |
| --- | --- | --- | --- |
| 01 | UIManager | ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿æ“ä½œ | ç”»é¢ã®æ“ä½œèª¬æ˜æ–‡ãŒå„ãƒ¢ãƒ¼ãƒ‰ã«é©ã—ãŸæ–‡è¨€ã«æ›´æ–°ã•ã‚Œã‚‹ |
| 02 | PlayButton | å†ç”Ÿ/ä¸€æ™‚åœæ­¢ã®åˆ‡æ›¿ | ãƒœã‚¿ãƒ³è¡¨è¨˜ã‚„ã‚¢ã‚¤ã‚³ãƒ³ãŒã€Œå†ç”Ÿã€ã€Œä¸€æ™‚åœæ­¢ã€ã«æ­£ã—ãåˆ‡ã‚Šæ›¿ã‚ã‚‹ |
| 03 | BodyWarning | è­¦å‘Šæœ‰åŠ¹/ç„¡åŠ¹ | å…¨èº«ãŒæ˜ ã£ã¦ã„ãªã„æ™‚ã®è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã®æœ‰ç„¡ãŒæ­£ã—ãåˆ‡ã‚Šæ›¿ã‚ã‚‹ |
| 04 | CountDown | ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ¤œå‡º | ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€è­¦å‘Šæ–‡è¡¨ç¤ºãŒæ­£ã—ãåˆ‡ã‚Šæ›¿ã‚ã‚‹ |
| 05 | FaceDetection | å£é–‹/é–‰ã®åˆ¤å®š | é–‹å£æ™‚ã®ã¿åˆ¤å®šåº§æ¨™ãŒæœ‰åŠ¹ã«ãªã‚Šã€é–‰å£æ™‚ã¯è§£é™¤ã•ã‚Œã‚‹ |
| 06 | SubmitButton | ç™»éŒ²å‡¦ç†ã®çŠ¶æ…‹å¤‰åŒ– | æˆåŠŸ/å¤±æ•—ã«å¿œã˜ã¦ãƒœã‚¿ãƒ³ã®æ–‡è¨€ãŒå¤‰ã‚ã‚Šã€é€£æ‰“ãŒé˜²æ­¢(disabled)ã•ã‚Œã‚‹ |
| 07 | ConfirmModal | é›¢è„±ã‚¤ãƒ™ãƒ³ãƒˆç™ºç« | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨é·ç§»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆOK/Cancelï¼‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ |
| 08 | RankingList | ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹(loading/error/empty) | ã€Œãƒ­ãƒ¼ãƒ‰ä¸­ã€ã€Œã‚¨ãƒ©ãƒ¼ã€ã€Œãƒ‡ãƒ¼ã‚¿ãªã—ã€ã®è¡¨ç¤ºãŒæ­£ã—ãåˆ‡ã‚Šæ›¿ã‚ã‚‹ |
| 09 | RankCalculator | ã‚¹ã‚³ã‚¢å¢ƒç•Œå€¤ | ãƒ©ãƒ³ã‚¯è¡¨ç¤ºï¼ˆS/A/B/Cï¼‰ãŒå¢ƒç•Œå€¤ã§æ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹ |

---

## ğŸ”§ é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### å¿…é ˆè¦ä»¶
- Node.js 20+
- Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ (Workers / Turnstile)
- Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm install
   ```

2. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**
    `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€å¿…è¦ãªAPIã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã™

3. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
   ```bash
   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ + ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰(ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
   npm run dev
   npm run cf:dev
   ```

4. **ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   npm run deploy
   ```

---

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ & ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ

- **License**: MIT
- **Music & Lyrics**: Powered by [TextAlive App API](https://api.songle.jp/) (National Institute of Advanced Industrial Science and Technology - AIST).
- **Vision AI**: MediaPipe by Google.
- **Special Thanks**: åŠ è³€ï¼ˆãƒã‚®ã‚·ãƒ£ãƒ¯ãƒ¼Pï¼‰ ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒ©ã‚¤ãƒˆ piaproï¼ˆhttps://piapro.jp/t/ULcJï¼‰