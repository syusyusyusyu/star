# Cross Stage (ã‚¯ãƒ­ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¸)

**éŸ³æ¥½ã¨èº«ä½“ãŒäº¤å·®ã™ã‚‹ã€æ¬¡ä¸–ä»£Webãƒªã‚ºãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚**

Cross Stage ã¯ã€TextAlive App API ã«ã‚ˆã‚‹æ­Œè©åŒæœŸæŠ€è¡“ã¨ MediaPipe Pose ã«ã‚ˆã‚‹èº«ä½“æ¤œçŸ¥AIã‚’èåˆã•ã›ãŸã€æ²¡å…¥å‹Webãƒªã‚ºãƒ ã‚²ãƒ¼ãƒ ã§ã™ã€‚
è¿‘æœªæ¥çš„ãªãƒ©ã‚¤ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’èˆå°ã«ã€æµã‚Œã¦ãã‚‹æ­Œè©ã‚’ã€Œæ´ã¿ã€ã€Œå¥ã§ã‚‹ã€ã‚ˆã†ãªä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![React](https://img.shields.io/badge/React-18-61DAFB?logo=react&logoColor=black)
![TypeScript](https://img.shields.io/badge/TypeScript-5.5-3178C6?logo=typescript&logoColor=white)
![Vite](https://img.shields.io/badge/Vite-5-646CFF?logo=vite&logoColor=white)
![Hono](https://img.shields.io/badge/Hono-Workers-E36002?logo=hono&logoColor=white)
![Supabase](https://img.shields.io/badge/Supabase-PostgreSQL-3ECF8E?logo=supabase&logoColor=white)

---

## ğŸ® ã‚²ãƒ¼ãƒ æ¦‚è¦

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ©ã‚¤ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¸ã®è¦³å®¢ã€ã‚ã‚‹ã„ã¯æ¼”è€…ã¨ãªã‚Šã€æ¥½æ›²ã«åˆã‚ã›ã¦æµã‚Œã¦ãã‚‹ã€Œæ­Œè©ãƒãƒ–ãƒ«ã€ã‚’ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚ˆãæ“ä½œã—ã¾ã™ã€‚å˜ãªã‚‹ã‚¿ãƒƒãƒ—ã§ã¯ãªãã€**ã€Œãƒ›ãƒ¼ãƒ«ãƒ‰ï¼ˆé•·æŠ¼ã—ï¼‰ã€**ã™ã‚‹ã“ã¨ã§ã‚²ãƒ¼ã‚¸ã‚’æºœã‚ã€ã‚¹ã‚³ã‚¢ã‚’ç¨¼ãç‹¬è‡ªã®ãƒªã‚ºãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### Immersive Live Experience
- **ãƒã‚ªãƒ³Ã—ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ **: æš—é—‡ã«è¼ããƒã‚ªãƒ³ãƒ©ã‚¤ãƒˆã¨ã€é€ãé€šã‚‹ã‚ˆã†ãªUIãƒ‡ã‚¶ã‚¤ãƒ³ã€‚
- **3Dã‚¹ãƒ†ãƒ¼ã‚¸æ¼”å‡º**: Three.js ã¨ CSS Animation ã‚’çµ„ã¿åˆã‚ã›ãŸã€è»½é‡ã‹ã¤ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãªãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°æ¼”å‡ºã€‚
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: PCã®å¤§ç”»é¢ã‹ã‚‰ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ç¸¦æŒã¡ãƒ—ãƒ¬ã‚¤ã¾ã§ã€ãƒ‡ãƒã‚¤ã‚¹ã«æœ€é©åŒ–ã•ã‚ŒãŸUIã€‚

---

## ğŸ•¹ï¸ ãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰

ãƒ‡ãƒã‚¤ã‚¹ã‚„ç’°å¢ƒã«åˆã‚ã›ã¦ã€3ã¤ã®æ“ä½œãƒ¢ãƒ¼ãƒ‰ã‚’æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

| ãƒ¢ãƒ¼ãƒ‰ | å¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹ | æ“ä½œæ–¹æ³• | ç‰¹å¾´ |
| :--- | :--- | :--- | :--- |
| **Cursor Mode** | PC / ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ | ãƒã‚¦ã‚¹ / ã‚¿ãƒƒãƒ | ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚„ã‚¿ãƒƒãƒæ“ä½œã§æ­Œè©ã‚’ãƒ›ãƒ¼ãƒ«ãƒ‰ã€‚æ‰‹è»½ã«æ¥½ã—ã‚ã‚‹åŸºæœ¬ãƒ¢ãƒ¼ãƒ‰ã€‚ |
| **Mobile Mode** | ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ | ã‚¿ãƒƒãƒ— & ãƒ›ãƒ¼ãƒ«ãƒ‰ | ã‚¹ãƒãƒ›æ“ä½œã«ç‰¹åŒ–ã€‚ç”»é¢ä¸‹éƒ¨ã®æ­Œè©è¡¨ç¤ºã‚’æ’é™¤ã—ã€ãƒ—ãƒ¬ã‚¤é ˜åŸŸã‚’æœ€å¤§åŒ–ã€‚è¦ªæŒ‡ä¸€ã¤ã§éŠã¹ã‚‹ç›´æ„Ÿçš„ãªæ“ä½œæ„Ÿã€‚ |
| **Body Mode** | PC (Webã‚«ãƒ¡ãƒ©) | å…¨èº«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | Webã‚«ãƒ¡ãƒ©ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹•ãã‚’æ¤œçŸ¥ã€‚æ‰‹ã‚„ä½“ã‚’æ­Œè©ã«é‡ã­ã¦ã€Œè§¦ã‚Œã‚‹ã€ã“ã¨ã§å…¥åŠ›ã™ã‚‹ã€å…¨èº«ã‚’ä½¿ã£ãŸã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ã€‚ |

---

## ğŸš€ æŠ€è¡“çš„ãªç‰¹å¾´

### Frontend (Modern Web)
- **React 19 & Vite**: é«˜é€Ÿãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨é–‹ç™ºä½“é¨“ã€‚
- **Architecture**: `GameManager` ã‚’ä¸­å¿ƒã¨ã—ãŸå³æ ¼ãªè²¬å‹™åˆ†é›¢ï¼ˆSRPï¼‰ã€‚ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã€å…¥åŠ›å‡¦ç†ã€æç”»ã€éŸ³å£°åŒæœŸã‚’ç‹¬ç«‹ç®¡ç†ã€‚
- **Performance**: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚„ãƒãƒ–ãƒ«ã®æç”»ã« `will-change` æœ€é©åŒ–ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒªãƒ³ã‚°ã‚’æ¡ç”¨ã—ã€Webãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§æ»‘ã‚‰ã‹ãª60fpså‹•ä½œã‚’å®Ÿç¾ã€‚

### Backend (Robust & Secure)
- **Cloudflare Workers & Hono**: ã‚¨ãƒƒã‚¸ã§ã®é«˜é€ŸãªAPIå‡¦ç†ã€‚
- **Supabase (PostgreSQL)**: RLS (Row Level Security) ã‚’æ´»ç”¨ã—ãŸå …ç‰¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€‚
- **Security First**:
  - **Turnstile**: Cloudflareã®ã‚¹ãƒãƒ¼ãƒˆCAPTCHAã«ã‚ˆã‚‹ãƒœãƒƒãƒˆæ’é™¤ã€‚
  - **HMACç½²å**: ã‚¹ã‚³ã‚¢é€ä¿¡æ™‚ã®æ”¹ã–ã‚“é˜²æ­¢ã€‚
  - **Idempotency**: å†ªç­‰æ€§ã‚’æ‹…ä¿ã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸å®‰å®šæ™‚ã®äºŒé‡æŠ•ç¨¿ã‚’é˜²æ­¢ã€‚

---

## ğŸ› ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```mermaid
graph TD
    User[Player] -->|Interact| FE[Frontend (React/Vite)]
    FE -->|Score/Rank| API[Cloudflare Workers (Hono)]
    FE -->|Lyrics| TA[TextAlive App API]
    FE -->|Vision| MP[MediaPipe Pose]
    
    subgraph "Backend (Edge)"
        API -->|Rate Limit| DO[Durable Objects]
        API -->|Verify| TS[Turnstile]
        API -->|Auth/DB| DB[(Supabase)]
    end
```

### ã‚¯ãƒ©ã‚¹è¨­è¨ˆ (Frontend)

```mermaid
classDiagram
  class GameManager {
    +start()
    +update()
    +draw()
  }
  class InputManager {
    +handleMouse()
    +handlePose()
  }
  class LyricsRenderer {
    +spawnBubble()
    +animate()
  }
  class EffectsManager {
    +spawnParticles()
    +showScorePopup()
  }
  
  GameManager --> InputManager
  GameManager --> LyricsRenderer
  GameManager --> EffectsManager
```

---

## ğŸ“¦ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```bash
star-5/
â”œâ”€â”€ src/                  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ components/       # React UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (Ranking, Modalç­‰)
â”‚   â”œâ”€â”€ game/             # ã‚²ãƒ¼ãƒ ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ GameManager.ts # ã‚²ãƒ¼ãƒ é€²è¡Œç®¡ç†
â”‚   â”‚   â”œâ”€â”€ GameLoop.ts    # ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
â”‚   â”‚   â””â”€â”€ ...           
â”‚   â”œâ”€â”€ pages/            # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ (Index, Game)
â”‚   â””â”€â”€ styles.css        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©
â”œâ”€â”€ worker/               # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»API (Cloudflare Workers)
â”‚   â”œâ”€â”€ index.ts          # Hono ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ rateLimiter.ts    # ãƒ¬ãƒ¼ãƒˆåˆ¶é™ (Durable Object)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ supabase_scores.sql   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â””â”€â”€ UI.md                 # UIãƒ‡ã‚¶ã‚¤ãƒ³è©³ç´°ä»•æ§˜æ›¸
```

---

## ğŸ”§ é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### å¿…é ˆè¦ä»¶
- Node.js 20+
- Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ (Workers / Turnstile)
- Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm install
   ```

2. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**
   `.dev.vars` ãŠã‚ˆã³ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€å¿…è¦ãªAPIã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã™ï¼ˆ`README_OLD.md` ã¾ãŸã¯ `TROUBLESHOOTING.md` å‚ç…§ï¼‰ã€‚

3. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
   ```bash
   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ + ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰(ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
   npm run dev
   npm run cf:dev
   ```

4. **ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   npm run deploy
   ```

---

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ & ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ

- **License**: MIT
- **Music & Lyrics**: Powered by [TextAlive App API](https://api.songle.jp/) (National Institute of Advanced Industrial Science and Technology - AIST).
- **Vision AI**: MediaPipe by Google.

---

*Enjoy the stage!* ğŸ¤âœ¨