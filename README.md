# Lyric Stage

**YouTube動画と字幕を同期**して表示し、ユーザーが表示された歌詞にインタラクトすることでスコアを獲得する革新的なリズムゲームです。

## プロジェクト概要

このプロジェクト「Lyric Stage」は、YouTube IFrame API + 自動字幕 (timedtext?kind=asr) の取得を基盤とする構成にリニューアルされました。

### 主要な特徴

- **字幕同期とインタラクション**: YouTube動画再生に合わせて字幕を正確なタイミングで表示。字幕は1文字ずつ出力され、ユーザーが表示された歌詞に触れることでスコアを獲得
- **3Dライブステージの表現**: Three.jsを用いて、ゲームの背景にダイナミックな3Dライブステージを構築
- **カメラベースの多様なインタラクション**: MediaPipe Pose と MediaPipe Hands を活用し、Webカメラを通じたユーザーの身体の動きをゲーム入力として利用

## セットアップと実行方法

### 1. 依存関係のインストール

```powershell
npm install
```

### 2. 実行（Windows/PowerShell）

字幕取得プロキシ（8080）と静的サイト（8000）の2つを起動します。

#### 方法1: 同時起動（推奨）
```powershell
npm run dev
```

#### 方法2: 個別起動
```powershell
# 字幕プロキシを起動（ポート 8080）
npm start

# 別のターミナルで静的サーバーを起動（ポート 8000）
npx http-server -p 8000
```

### 3. ブラウザでアクセス
http://localhost:8000/index.html を開く

## 遊び方

1. **タイトル画面**: YouTube URL入力欄に動画URLを貼り、「再生」ボタンを押す
2. **プレイモード選択**:
   - **カーソルモード**: マウス/タップで歌詞に触れる
   - **ハンドモード**: Webカメラで手を検出して操作
   - **ボディモード**: Webカメラで全身を検出して操作
3. **ゲームプレイ**:
   - YouTube動画が再生されると自動字幕を取得し、1文字ずつ表示される
   - 歌詞に触れるとスコアが加算、連続ヒットでコンボ加算
4. **リザルト画面**: 曲終了時にスコアとランクを表示

## プロジェクト構造

- `index.html`: タイトル画面。YouTube URL入力欄、モード選択、再生ボタンを含む
- `game.html`: ゲーム画面。YouTubeプレイヤー、字幕、スコア表示、3Dステージを含む
- `script.js`: ゲームロジック。動画時間に基づく字幕同期処理、1文字ずつの出力、インタラクション判定、スコア管理
- `game-loader.js`: `game.html` ロード時に初期化を行う
- `styles.css`: ゲーム画面用スタイル
- `index-styles.css`: タイトル画面用スタイル
- `index-scripts.js`: タイトル画面のイベント処理
- `server.js`: 字幕取得用のExpressプロキシサーバー
- `package.json`: 依存関係とスクリプトの定義

## 使用技術

- **HTML5 / CSS3 / JavaScript (ES6+)**
- **YouTube IFrame API**（動画再生と自動字幕取得）
- **Three.js**（3D演出）
- **MediaPipe Pose / Hands / Selfie Segmentation**（カメラ入力・動作検出・背景合成）
- **Express.js**（字幕プロキシサーバー）

## トラブルシュート

### 画面が「Loading subtitles...」から進まない / エラーになる
- `npm start` で字幕プロキシ（8080）が起動しているか確認
- Windowsのファイアウォールや他のアプリで 8080/8000 が塞がっていないか確認
- 該当動画に自動字幕（または任意の字幕）が存在しない場合は取得できません。別の動画で確認

### CORS エラーが出る
- 8080 のローカルプロキシを介して取得する設計です。必ずプロキシを起動してください

### 8000番だけ起動しても動かない
- フロントは表示されますが字幕取得に失敗します。8080のプロキシが必須です

### YouTube動画が再生されない
- 一部の動画は埋め込み再生が制限されている場合があります
- 別のYouTube動画で試してください

## 開発者向け情報

### アーキテクチャ
1. フロントエンド（8000番ポート）: 静的HTML/CSS/JavaScript
2. プロキシサーバー（8080番ポート）: YouTube字幕取得のCORS回避
3. YouTube IFrame API: 動画再生制御
4. MediaPipe: カメラベースの入力検出

### 今後の改善点
- より多くのYouTube動画との互換性向上
- 字幕の精度向上
- 3D演出の強化
- スコアシステムの改良

## ライセンス

MIT License
