const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/camera_utils-DDupHUgx.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/hands-DSkHx6hn.js","assets/pose-CfBJBx5o.js","assets/selfie_segmentation-DaLfK2Le.js"])))=>i.map(i=>d[i]);
var it=Object.defineProperty;var st=(n,e,t)=>e in n?it(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Le=(n,e,t)=>st(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=t(l);fetch(l.href,r)}})();function D(){}function Xe(n){return n()}function Ie(){return Object.create(null)}function Y(n){n.forEach(Xe)}function Ke(n){return typeof n=="function"}function se(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function ot(n){return Object.keys(n).length===0}function Ye(n,...e){if(n==null){for(const i of e)i(void 0);return D}const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function q(n){let e;return Ye(n,t=>e=t)(),e}function J(n,e,t){n.$$.on_destroy.push(Ye(e,t))}function d(n,e){n.appendChild(e)}function x(n,e,t){n.insertBefore(e,t||null)}function w(n){n.parentNode&&n.parentNode.removeChild(n)}function lt(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function p(n){return document.createElement(n)}function z(n){return document.createTextNode(n)}function b(){return z(" ")}function rt(){return z("")}function X(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function at(n){return function(e){return e.preventDefault(),n.call(this,e)}}function h(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function ct(n){return Array.from(n.childNodes)}function W(n,e){e=""+e,n.data!==e&&(n.data=e)}function Me(n,e){n.value=e??""}function Oe(n,e,t,i){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,"")}function He(n,e,t){for(let i=0;i<n.options.length;i+=1){const l=n.options[i];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function dt(n){const e=n.querySelector(":checked");return e&&e.__value}function we(n,e,t){n.classList.toggle(e,!!t)}function ut(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}let be;function _e(n){be=n}function Qe(){if(!be)throw new Error("Function called outside component initialization");return be}function Ze(n){Qe().$$.on_mount.push(n)}function ve(){const n=Qe();return(e,t,{cancelable:i=!1}={})=>{const l=n.$$.callbacks[e];if(l){const r=ut(e,t,{cancelable:i});return l.slice().forEach(o=>{o.call(n,r)}),!r.defaultPrevented}return!0}}const re=[],Ue=[];let de=[];const ze=[],ft=Promise.resolve();let Be=!1;function ht(){Be||(Be=!0,ft.then(et))}function $e(n){de.push(n)}const Re=new Set;let oe=0;function et(){if(oe!==0)return;const n=be;do{try{for(;oe<re.length;){const e=re[oe];oe++,_e(e),mt(e.$$)}}catch(e){throw re.length=0,oe=0,e}for(_e(null),re.length=0,oe=0;Ue.length;)Ue.pop()();for(let e=0;e<de.length;e+=1){const t=de[e];Re.has(t)||(Re.add(t),t())}de.length=0}while(re.length);for(;ze.length;)ze.pop()();Be=!1,Re.clear(),_e(n)}function mt(n){if(n.fragment!==null){n.update(),Y(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach($e)}}function pt(n){const e=[],t=[];de.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),de=e}const ke=new Set;let ne;function gt(){ne={r:0,c:[],p:ne}}function _t(){ne.r||Y(ne.c),ne=ne.p}function K(n,e){n&&n.i&&(ke.delete(n),n.i(e))}function ie(n,e,t,i){if(n&&n.o){if(ke.has(n))return;ke.add(n),ne.c.push(()=>{ke.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function Pe(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function yt(n,e){n.d(1),e.delete(n.key)}function bt(n,e,t,i,l,r,o,a,c,s,u,f){let _=n.length,m=r.length,g=_;const S={};for(;g--;)S[n[g].key]=g;const y=[],E=new Map,L=new Map,A=[];for(g=m;g--;){const v=f(l,r,g),T=t(v);let I=o.get(T);I?A.push(()=>I.p(v,e)):(I=s(T,v),I.c()),E.set(T,y[g]=I),T in S&&L.set(T,Math.abs(g-S[T]))}const R=new Set,$=new Set;function C(v){K(v,1),v.m(a,u),o.set(v.key,v),u=v.first,m--}for(;_&&m;){const v=y[m-1],T=n[_-1],I=v.key,N=T.key;v===T?(u=v.first,_--,m--):E.has(N)?!o.has(I)||R.has(I)?C(v):$.has(N)?_--:L.get(I)>L.get(N)?($.add(I),C(v)):(R.add(N),_--):(c(T,o),_--)}for(;_--;){const v=n[_];E.has(v.key)||c(v,o)}for(;m;)C(y[m-1]);return Y(A),y}function ye(n){n&&n.c()}function ue(n,e,t){const{fragment:i,after_update:l}=n.$$;i&&i.m(e,t),$e(()=>{const r=n.$$.on_mount.map(Xe).filter(Ke);n.$$.on_destroy?n.$$.on_destroy.push(...r):Y(r),n.$$.on_mount=[]}),l.forEach($e)}function fe(n,e){const t=n.$$;t.fragment!==null&&(pt(t.after_update),Y(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function vt(n,e){n.$$.dirty[0]===-1&&(re.push(n),ht(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function he(n,e,t,i,l,r,o=null,a=[-1]){const c=be;_e(n);const s=n.$$={fragment:null,ctx:[],props:r,update:D,not_equal:l,bound:Ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Ie(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};o&&o(s.root);let u=!1;if(s.ctx=t?t(n,e.props||{},(f,_,...m)=>{const g=m.length?m[0]:_;return s.ctx&&l(s.ctx[f],s.ctx[f]=g)&&(!s.skip_bound&&s.bound[f]&&s.bound[f](g),u&&vt(n,f)),_}):[],s.update(),u=!0,Y(s.before_update),s.fragment=i?i(s.ctx):!1,e.target){if(e.hydrate){const f=ct(e.target);s.fragment&&s.fragment.l(f),f.forEach(w)}else s.fragment&&s.fragment.c();e.intro&&K(n.$$.fragment),ue(n,e.target,e.anchor),et()}_e(c)}class me{constructor(){Le(this,"$$");Le(this,"$$set")}$destroy(){fe(this,1),this.$destroy=D}$on(e,t){if(!Ke(t))return D;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!ot(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const wt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wt);function Fe(n,e,t){const i=n.slice();return i[7]=e[t],i}function De(n){let e;return{c(){e=p("div"),e.textContent="モバイルではCursorモード固定です",h(e,"class","text-gray-300 text-sm mt-2")},m(t,i){x(t,e,i)},d(t){t&&w(e)}}}function je(n){let e,t,i,l,r,o,a,c,s,u,f;function _(...m){return n[5](n[7],...m)}return{c(){e=p("li"),t=p("button"),i=p("div"),l=p("h3"),l.textContent=`${n[7].title}`,r=b(),o=p("p"),o.textContent=`${n[7].artist}`,a=b(),c=p("div"),c.textContent="プレイ",s=b(),h(l,"class","text-xl text-[#39C5BB] font-medium"),h(o,"class","text-white/70 text-sm"),h(c,"class","bg-[#39C5BB] text-white px-4 py-2 rounded-lg"),h(t,"class","w-full p-4 text-left flex justify-between items-center focus:outline-none"),h(e,"class","song-item bg-black/40 rounded-lg backdrop-blur-sm border border-[#39C5BB]/30")},m(m,g){x(m,e,g),d(e,t),d(t,i),d(i,l),d(i,r),d(i,o),d(t,a),d(t,c),d(e,s),u||(f=X(t,"click",_),u=!0)},p(m,g){n=m},d(m){m&&w(e),u=!1,f()}}}function xt(n){let e,t,i,l,r,o,a,c,s,u,f,_,m,g,S,y,E,L,A,R,$,C,v,T,I,N,M=n[1]&&De(),U=Pe(n[2]),O=[];for(let P=0;P<U.length;P+=1)O[P]=je(Fe(n,U,P));return{c(){e=p("div"),t=b(),i=p("div"),l=b(),r=p("div"),o=b(),a=p("div"),c=b(),s=p("div"),u=p("div"),u.innerHTML='<h1 class="text-3xl xs:text-4xl sm:text-5xl md:text-6xl font-bold text-miku mb-2 tracking-wider">Lyric Stage</h1>',f=b(),_=p("div"),_.innerHTML='<p class="text-white/90 text-sm sm:text-base">歌詞の文字に触れてポイントを獲得しよう！</p>',m=b(),g=p("div"),S=p("label"),S.textContent="Playモード選択:",y=b(),E=p("select"),L=p("option"),L.textContent="Cursorモード",A=p("option"),A.textContent="Handモード（カメラ）",R=p("option"),R.textContent="Bodyモード（カメラ）",$=b(),M&&M.c(),C=b(),v=p("div"),T=p("ul");for(let P=0;P<O.length;P+=1)O[P].c();h(e,"id","stars-container"),h(e,"class","fixed top-0 left-0 w-full h-full z-0"),h(i,"class","spotlight left-1/4 hidden sm:block"),h(r,"class","spotlight left-2/4 hidden sm:block"),Oe(r,"animation-delay","-3s"),h(a,"class","spotlight left-3/4 hidden sm:block"),Oe(a,"animation-delay","-6s"),h(u,"class","text-center mb-4 sm:mb-6"),h(_,"class","max-w-md mx-auto text-center mb-4 sm:mb-6 bg-black/30 p-2 sm:p-2 rounded-lg backdrop-blur-sm"),h(S,"for","game-mode"),h(S,"class","text-white mr-2 text-lg"),L.__value="cursor",Me(L,L.__value),A.__value="hand",Me(A,A.__value),R.__value="body",Me(R,R.__value),h(E,"id","game-mode"),h(E,"class","p-2 rounded bg-gray-700 text-white text-lg"),E.disabled=n[1],n[0]===void 0&&$e(()=>n[4].call(E)),h(g,"id","mode-selection"),h(g,"class","mt-4 mb-6 text-center"),h(T,"class","space-y-2 sm:space-y-3"),h(v,"class","max-w-lg w-full mx-auto"),h(s,"class","relative z-10 w-full max-w-xl flex flex-col items-center justify-center py-6 px-4 min-h-screen text-white")},m(P,F){x(P,e,F),x(P,t,F),x(P,i,F),x(P,l,F),x(P,r,F),x(P,o,F),x(P,a,F),x(P,c,F),x(P,s,F),d(s,u),d(s,f),d(s,_),d(s,m),d(s,g),d(g,S),d(g,y),d(g,E),d(E,L),d(E,A),d(E,R),He(E,n[0],!0),d(g,$),M&&M.m(g,null),d(s,C),d(s,v),d(v,T);for(let B=0;B<O.length;B+=1)O[B]&&O[B].m(T,null);I||(N=X(E,"change",n[4]),I=!0)},p(P,[F]){if(F&2&&(E.disabled=P[1]),F&1&&He(E,P[0]),P[1]?M||(M=De(),M.c(),M.m(g,null)):M&&(M.d(1),M=null),F&12){U=Pe(P[2]);let B;for(B=0;B<U.length;B+=1){const V=Fe(P,U,B);O[B]?O[B].p(V,F):(O[B]=je(V),O[B].c(),O[B].m(T,null))}for(;B<O.length;B+=1)O[B].d(1);O.length=U.length}},i:D,o:D,d(P){P&&(w(e),w(t),w(i),w(l),w(r),w(o),w(a),w(c),w(s)),M&&M.d(),lt(O,P),I=!1,N()}}}function kt(){const n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e="ontouchstart"in window||navigator.maxTouchPoints>0,t=window.innerWidth<=768,i=/iPhone|iPad|iPod/i.test(navigator.userAgent);return n||e&&t||i}function Ne(){const n=document.getElementById("stars-container");if(!n)return;const e=Math.min(100,Math.floor(window.innerWidth*window.innerHeight/6e3));n.innerHTML="";const t=document.createDocumentFragment();for(let i=0;i<e;i++){const l=document.createElement("div");l.className="star",l.style.left=`${Math.random()*100}%`,l.style.top=`${Math.random()*100}%`,l.style.animationDelay=`${Math.random()*3}s`,Math.random()>.7&&(l.style.width="6px",l.style.height="6px",l.style.boxShadow="0 0 10px #fff"),t.appendChild(l)}n.appendChild(t)}function $t(n){const e=n.currentTarget??n.target;if(!e)return;const t=e.getBoundingClientRect(),i=document.createElement("div"),l=(n.clientX??t.left+t.width/2)-t.left,r=(n.clientY??t.top+t.height/2)-t.top;i.className="absolute bg-white/40 rounded-full pointer-events-none",i.style.width="100px",i.style.height="100px",i.style.left=`${l}px`,i.style.top=`${r}px`,i.style.transform="translate(-50%, -50%) scale(0)",i.style.animation="ripple 0.6s ease-out forwards",e.style.position="relative",e.style.overflow="hidden",e.appendChild(i),setTimeout(()=>i.remove(),650)}function Pt(n,e,t){const i=ve(),l=[{id:1,title:"ストリートライト",artist:"加賀(ネギシャワーP)",apiToken:"HmfsoBVch26BmLCm",songUrl:"https://piapro.jp/t/ULcJ/20250205120202"},{id:2,title:"アリフレーション",artist:"雨良 Amala",apiToken:"rdja5JxMEtcYmyKP",songUrl:"https://piapro.jp/t/SuQO/20250127235813"},{id:3,title:"インフォーマルダイブ",artist:"99piano",apiToken:"CqbpJNJHwoGvXhlD",songUrl:"https://piapro.jp/t/Ppc9/20241224135843"},{id:4,title:"ハロー、フェルミ。",artist:"ど～ぱみん",apiToken:"o1B1ZygOqyhK5B3D",songUrl:"https://piapro.jp/t/oTaJ/20250204234235"},{id:5,title:"パレードレコード",artist:"きさら",apiToken:"G8MU8Wf87RotH8OR",songUrl:"https://piapro.jp/t/GCgy/20250202202635"},{id:6,title:"ロンリーラン",artist:"海風太陽",apiToken:"fI0SyBEEBzlB2f5C",songUrl:"https://piapro.jp/t/CyPO/20250128183915"}];let r="cursor",o=!1;function a(u){localStorage.setItem("selectedSong",JSON.stringify(u));const f=new URL(location.href);f.searchParams.set("page","game"),f.searchParams.set("mode",r),history.pushState({},"",f),i("startGame")}Ze(()=>{const u="/star/";if(!document.getElementById("index-styles-link")){const m=document.createElement("link");m.id="index-styles-link",m.rel="stylesheet",m.href=`${u}index-styles.css`,document.head.appendChild(m)}t(1,o=kt()),o&&t(0,r="cursor"),Ne();let f;const _=()=>{clearTimeout(f),f=setTimeout(Ne,250)};return window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)});function c(){r=dt(this),t(0,r)}return[r,o,l,a,c,(u,f)=>{$t(f),a(u)}]}class Et extends me{constructor(e){super(),he(this,e,Pt,xt,se,{})}}const Ct="modulepreload",Tt=function(n){return"/star/"+n},qe={},pe=function(e,t,i){let l=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));l=Promise.allSettled(t.map(c=>{if(c=Tt(c),c in qe)return;qe[c]=!0;const s=c.endsWith(".css"),u=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=s?"stylesheet":Ct,s||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),s)return new Promise((_,m)=>{f.addEventListener("load",_),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return l.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},le=[];function G(n,e=D){let t;const i=new Set;function l(a){if(se(n,a)&&(n=a,t)){const c=!le.length;for(const s of i)s[1](),le.push(s,n);if(c){for(let s=0;s<le.length;s+=2)le[s][0](le[s+1]);le.length=0}}}function r(a){l(a(n))}function o(a,c=D){const s=[a,c];return i.add(s),i.size===1&&(t=e(l,r)||D),a(n),()=>{i.delete(s),i.size===0&&t&&(t(),t=null)}}return{set:l,update:r,subscribe:o}}const ae=G(0),ce=G(0),xe=G(0),j=G(!0),ge=G("ゲームをロード中..."),Ee=G(""),tt=G(!1),nt=G({score:0,maxCombo:0,rank:"C"}),We=G("cursor"),te=G([]),Ge=G(!1),St=G(null);function Ve(n,e,t){const i=n.slice();return i[6]=e[t],i}function Je(n,e){let t,i=e[6].text+"",l,r,o,a,c,s;function u(){return e[2](e[6])}function f(){return e[3](e[6])}function _(...m){return e[4](e[6],...m)}return{key:n,first:null,c(){t=p("div"),l=z(i),r=b(),h(t,"class","lyric-bubble pointer-events-auto"),h(t,"style",o=`left:${e[6].x}px; top:${e[6].y}px; color:${e[6].color}; font-size:${e[6].fontSize};`),h(t,"role","button"),h(t,"tabindex","0"),h(t,"aria-label",a=`歌詞 ${e[6].text}`),this.first=t},m(m,g){x(m,t,g),d(t,l),d(t,r),c||(s=[X(t,"mouseenter",u),X(t,"touchstart",at(f)),X(t,"keydown",_)],c=!0)},p(m,g){e=m,g&1&&i!==(i=e[6].text+"")&&W(l,i),g&1&&o!==(o=`left:${e[6].x}px; top:${e[6].y}px; color:${e[6].color}; font-size:${e[6].fontSize};`)&&h(t,"style",o),g&1&&a!==(a=`歌詞 ${e[6].text}`)&&h(t,"aria-label",a)},d(m){m&&w(t),c=!1,Y(s)}}}function Lt(n){let e,t=[],i=new Map,l=Pe(n[0]);const r=o=>o[6].id;for(let o=0;o<l.length;o+=1){let a=Ve(n,l,o),c=r(a);i.set(c,t[o]=Je(c,a))}return{c(){e=p("div");for(let o=0;o<t.length;o+=1)t[o].c();h(e,"class","absolute inset-0 pointer-events-none")},m(o,a){x(o,e,a);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null)},p(o,[a]){a&3&&(l=Pe(o[0]),t=bt(t,a,r,1,o,l,i,e,yt,Je,null,Ve))},i:D,o:D,d(o){o&&w(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Mt(n,e,t){const i=ve();let l=[];function r(s){q(j)||i("click",{id:s})}const o=s=>r(s.id),a=s=>r(s.id),c=(s,u)=>{(u.key==="Enter"||u.key===" ")&&r(s.id)};return te.subscribe(s=>t(0,l=s)),[l,r,o,a,c]}class Rt extends me{constructor(e){super(),he(this,e,Mt,Lt,se,{})}}function Bt(n){let e,t,i,l,r,o,a,c,s,u=(n[2]||"歌詞の文字にマウスを当ててポイントを獲得しよう！")+"",f,_,m,g,S=n[3]?"再生":"一時停止",y,E,L,A,R;return{c(){e=p("div"),t=p("div"),i=z(n[0]),l=b(),r=p("div"),o=z("コンボ: "),a=z(n[1]),c=b(),s=p("div"),f=z(u),_=b(),m=p("div"),g=p("button"),y=z(S),E=b(),L=p("button"),L.textContent="最初から",h(t,"id","score"),h(r,"id","combo"),h(e,"id","score-container"),h(s,"id","instructions"),h(g,"id","play-pause"),h(L,"id","restart"),h(m,"id","controls")},m($,C){x($,e,C),d(e,t),d(t,i),d(e,l),d(e,r),d(r,o),d(r,a),x($,c,C),x($,s,C),d(s,f),x($,_,C),x($,m,C),d(m,g),d(g,y),d(m,E),d(m,L),A||(R=[X(g,"click",n[5]),X(L,"click",n[6])],A=!0)},p($,[C]){C&1&&W(i,$[0]),C&2&&W(a,$[1]),C&4&&u!==(u=($[2]||"歌詞の文字にマウスを当ててポイントを獲得しよう！")+"")&&W(f,u),C&8&&S!==(S=$[3]?"再生":"一時停止")&&W(y,S)},i:D,o:D,d($){$&&(w(e),w(c),w(s),w(_),w(m)),A=!1,Y(R)}}}function At(n,e,t){let i,l,r,o;J(n,ae,u=>t(0,i=u)),J(n,ce,u=>t(1,l=u)),J(n,Ee,u=>t(2,r=u)),J(n,j,u=>t(3,o=u));const a=ve();return[i,l,r,o,a,()=>a("toggle"),()=>a("restart")]}class It extends me{constructor(e){super(),he(this,e,At,Bt,se,{})}}function Ot(n){let e,t,i,l,r,o,a,c=n[1].score+"",s,u,f,_,m=n[1].maxCombo+"",g,S,y,E,L=n[1].rank+"",A,R,$,C,v,T,I,N;return{c(){e=p("div"),t=p("div"),i=p("h2"),i.textContent="リザルト",l=b(),r=p("div"),o=p("div"),a=p("div"),s=z(c),u=b(),f=p("div"),_=z("最大コンボ: "),g=z(m),S=b(),y=p("div"),E=z("ランク: "),A=z(L),R=b(),$=p("div"),C=p("button"),C.textContent="タイトルへ戻る",v=b(),T=p("button"),T.textContent="もう一度プレイ",h(a,"id","final-score-display"),h(f,"id","final-combo-display"),h(y,"id","rank-display"),h(o,"class","results-score-section"),h(r,"class","results-content"),h($,"class","results-buttons"),h(t,"class","results-container"),h(e,"id","results-screen"),we(e,"hidden",!n[0]),we(e,"show",n[0])},m(M,U){x(M,e,U),d(e,t),d(t,i),d(t,l),d(t,r),d(r,o),d(o,a),d(a,s),d(o,u),d(o,f),d(f,_),d(f,g),d(o,S),d(o,y),d(y,E),d(y,A),d(t,R),d(t,$),d($,C),d($,v),d($,T),I||(N=[X(C,"click",n[3]),X(T,"click",n[4])],I=!0)},p(M,[U]){U&2&&c!==(c=M[1].score+"")&&W(s,c),U&2&&m!==(m=M[1].maxCombo+"")&&W(g,m),U&2&&L!==(L=M[1].rank+"")&&W(A,L),U&1&&we(e,"hidden",!M[0]),U&1&&we(e,"show",M[0])},i:D,o:D,d(M){M&&w(e),I=!1,Y(N)}}}function Ht(n,e,t){let i,l;J(n,tt,c=>t(0,i=c)),J(n,nt,c=>t(1,l=c));const r=ve();return[i,l,r,()=>r("back"),()=>r("replay")]}class Ut extends me{constructor(e){super(),he(this,e,Ht,Ot,se,{})}}class zt{constructor(){this.startTime=0,this.lyricTimer=null,this.randomTextTimer=null,this.displayed=new Set,this.player=null,this.isPlayerInit=!1,this._op=!1,this.camera=null,this.hands=null,this.pose=null,this.videoEl=null,this.mpActiveMode=null,this.seg=null,this.segCanvas=null,this.segCtx=null}init(e,t){St.set(e),We.set(t),ge.set(`${e.title} をロード中...`),Ee.set(this.buildInstructions(t)),this.initPlayer(e),(t==="hand"||t==="body")&&this.initMediaPipe(t).catch(()=>{We.set("cursor"),Ee.set(this.buildInstructions("cursor"))})}buildInstructions(e){switch(e){case"cursor":return"歌詞の文字にマウスを当ててポイントを獲得しよう！";case"hand":return"カメラに手を映して歌詞に触れてポイントを獲得しよう！";case"body":return"カメラに全身を映して歌詞に触れてポイントを獲得しよう！"}}initPlayer(e){if(typeof window.TextAliveApp>"u"){this.fallback();return}try{const t=window.TextAliveApp;this.player=new t.Player({app:{token:e.apiToken},mediaElement:document.createElement("audio")}),document.body.appendChild(this.player.mediaElement),this.isPlayerInit=!0,this.player.addListener({onAppReady:i=>{if(i&&!i.managed)try{this.player.createFromSongUrl(e.songUrl)}catch{this.fallback()}},onVideoReady:i=>{ge.set("準備中..."),setTimeout(()=>{Ge.set(!0),j.set(!0),ge.set("準備完了-「再生」ボタンを押してね")},800)},onTimeUpdate:i=>{q(j)||this.updateLyrics(i)},onPlay:()=>{j.set(!1),this.startRandomText()},onPause:()=>{j.set(!0),this.stopRandomText()},onFinish:()=>this.showResults(),onError:()=>this.fallback()})}catch{this.fallback()}}fallback(){this.isPlayerInit=!1,Ge.set(!0),j.set(!0),ge.set("準備完了 - 下の「再生」ボタンを押してください")}async play(){if(!this._op){this._op=!0;try{if(this.isPlayerInit&&this.player&&!this.player.isPlaying)try{await this.player.requestPlay()}catch{this.fallback(),this.startFallbackLyrics()}else this.isPlayerInit||this.startFallbackLyrics();this.startRandomText()}finally{setTimeout(()=>this._op=!1,500)}}}pause(){var e;if((e=this.player)!=null&&e.isPlaying)try{this.player.requestPause()}catch{}j.set(!0),this.stopRandomText()}restart(){if(ce.set(0),ae.set(0),xe.set(0),this.displayed.clear(),te.set([]),this.isPlayerInit&&this.player)try{this.player.requestStop(),setTimeout(()=>this.player.requestPlay(),300)}catch{}else this.startFallbackLyrics()}startFallbackLyrics(){this.startTime=Date.now(),this.lyricTimer&&cancelAnimationFrame(this.lyricTimer);const e=[{text:"マジカル",t:1e3},{text:"ミライ",t:4e3},{text:"初音ミク",t:6500}],t=[];e.forEach(r=>Array.from(r.text.normalize("NFC")).forEach((o,a)=>{t.push({time:r.t+a*400,text:o,dur:600})}));let i=0;const l=()=>{if(q(j)){this.lyricTimer=requestAnimationFrame(l);return}const r=Date.now()-this.startTime;for(;i<t.length&&t[i].time<=r;)this.spawnBubble(t[i].text,t[i].dur),i++;i>=t.length?setTimeout(()=>this.showResults(),5e3):this.lyricTimer=requestAnimationFrame(l)};j.set(!1),l()}updateLyrics(e){var l;const t=(l=this.player)==null?void 0:l.video;if(!t)return;let i=t.firstPhrase;for(;i;){let r=i.firstWord;for(;r;){let o=r.firstChar;for(;o;){if(o.startTime<=e&&o.startTime>e-500){const a=(o.text??"").toString().trim();a&&this.spawnBubble(a,Math.max(3e3,o.endTime-o.startTime))}o=o.next}r=r.next}i=i.next}}spawnBubble(e,t){const i=`${Date.now()}-${Math.random()}`,l=window.innerWidth,r=l<=768,o=r?l*.15+Math.random()*(l*.7):100+Math.random()*(l-300),a=r?window.innerHeight*.3+Math.random()*(window.innerHeight*.55):window.innerHeight-300-Math.random()*100,c=r?l<=480?"18px":"22px":"48px",s={id:i,text:String(e).normalize("NFC"),x:o,y:a,color:"#39C5BB",fontSize:c,expiresAt:Date.now()+Math.min(8e3,Math.max(3e3,t)),clicked:!1};te.update(u=>[...u,s]),setTimeout(()=>{te.update(u=>u.filter(f=>f.id!==i)),!q(j)&&!s.clicked&&ce.set(0)},Math.min(8e3,Math.max(3e3,t)))}clickBubble(e){let t=q(ae),i=q(ce)+1;ce.set(i),xe.set(Math.max(q(xe),i));const l=100*(Math.floor(i/5)+1);ae.set(t+l),te.update(r=>r.map(o=>o.id===e?{...o,clicked:!0,color:"#FF69B4"}:o))}startRandomText(){this.randomTextTimer||(this.randomTextTimer=window.setInterval(()=>{},500))}stopRandomText(){this.randomTextTimer&&(clearInterval(this.randomTextTimer),this.randomTextTimer=null)}showResults(){j.set(!0);const e=q(ae),t=q(xe);let i="C";e>=1e4?i="S":e>=8e3?i="A":e>=6e3&&(i="B"),nt.set({score:e,maxCombo:t,rank:i}),tt.set(!0)}async initMediaPipe(e){try{if(this.videoEl=document.getElementById("camera-video"),!this.videoEl)throw new Error("video element not found");const t=window.__BASE_URL||"/star/",[{Camera:i},l,r,o]=await Promise.all([pe(()=>import("./camera_utils-DDupHUgx.js").then(s=>s.c),__vite__mapDeps([0,1])),e==="hand"?pe(()=>import("./hands-DSkHx6hn.js").then(s=>s.h),__vite__mapDeps([2,1])):Promise.resolve(null),e==="body"?pe(()=>import("./pose-CfBJBx5o.js").then(s=>s.p),__vite__mapDeps([3,1])):Promise.resolve(null),pe(()=>import("./selfie_segmentation-DaLfK2Le.js").then(s=>s.s),__vite__mapDeps([4,1]))]),a=s=>u=>`${t}mediapipe/${s}/${u}`;e==="hand"&&l&&(this.hands=new l.Hands({locateFile:a("hands")}),this.hands.setOptions({selfieMode:!0,maxNumHands:2,modelComplexity:1,minDetectionConfidence:.6,minTrackingConfidence:.6}),this.hands.onResults(s=>this.onHandsResults(s))),e==="body"&&r&&(this.pose=new r.Pose({locateFile:a("pose")}),this.pose.setOptions({selfieMode:!0,modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,minDetectionConfidence:.6,minTrackingConfidence:.6}),this.pose.onResults(s=>this.onPoseResults(s)));const c=document.getElementById("segmentation-canvas");c&&o&&(this.seg=new o.SelfieSegmentation({locateFile:a("selfie_segmentation")}),this.seg.setOptions({modelSelection:1}),this.seg.onResults(s=>this.onSegmentationResults(s)),this.segCanvas=c,this.segCtx=c.getContext("2d")),this.camera=new i(this.videoEl,{onFrame:async()=>{if(!q(j))try{this.seg&&await this.seg.send({image:this.videoEl}),this.hands?await this.hands.send({image:this.videoEl}):this.pose&&await this.pose.send({image:this.videoEl})}catch{}},width:640,height:480}),await this.camera.start(),this.mpActiveMode=e}catch(t){throw console.warn("MediaPipe init failed",t),this.stopMediaPipe(),t}}stopMediaPipe(){var e,t;try{(t=(e=this.camera)==null?void 0:e.stop)==null||t.call(e)}catch{}this.camera=null,this.hands=null,this.pose=null,this.seg=null,this.mpActiveMode=null}onHandsResults(e){if(!e||!e.multiHandLandmarks)return;const t=window.innerWidth,i=window.innerHeight,l=new Set,r=q(te),o=t<=480?60:t<=768?50:40;for(const a of e.multiHandLandmarks){const c=[8,12];for(const s of c){const u=a[s];if(!u)continue;const f=(1-u.x)*t,_=u.y*i;for(const m of r){if(m.clicked)continue;const g=m.x-f,S=m.y-_;g*g+S*S<=o*o&&l.add(m.id)}}}q(j)||l.forEach(a=>this.clickBubble(a))}onPoseResults(e){if(!e||!e.poseLandmarks)return;const t=window.innerWidth,i=window.innerHeight,l=new Set,r=q(te),o=t<=480?70:t<=768?60:50,a=[15,16];for(const c of a){const s=e.poseLandmarks[c];if(!s)continue;const u=(1-s.x)*t,f=s.y*i;for(const _ of r){if(_.clicked)continue;const m=_.x-u,g=_.y-f;m*m+g*g<=o*o&&l.add(_.id)}}q(j)||l.forEach(c=>this.clickBubble(c))}onSegmentationResults(e){var f,_;if(!this.segCanvas||!this.segCtx||!e)return;const t=this.segCanvas,i=this.segCtx,l=((f=this.videoEl)==null?void 0:f.videoWidth)||640,r=((_=this.videoEl)==null?void 0:_.videoHeight)||480;(t.width!==window.innerWidth||t.height!==window.innerHeight)&&(t.width=window.innerWidth,t.height=window.innerHeight),i.save();const o=Math.max(t.width/l,t.height/r),a=l*o,c=r*o,s=(t.width-a)/2,u=(t.height-c)/2;i.drawImage(this.videoEl,s,u,a,c),e.segmentationMask&&(i.globalCompositeOperation="destination-in",i.drawImage(e.segmentationMask,s,u,a,c),i.globalCompositeOperation="destination-over",i.fillStyle="rgba(0,0,0,0.5)",i.fillRect(0,0,t.width,t.height)),i.restore()}}function Ft(n){let e,t,i,l,r,o,a,c,s,u,f,_,m,g,S,y,E,L,A,R,$,C,v,T,I,N,M,U,O=(n[4]||"歌詞の文字にマウスを当ててポイントを獲得しよう！")+"",P,F,B,V,Ce,ee,Te,Q,Z,Se,Ae;return V=new It({}),V.$on("toggle",n[8]),V.$on("restart",n[9]),ee=new Rt({}),ee.$on("click",n[10]),Q=new Ut({}),Q.$on("back",n[11]),Q.$on("replay",n[12]),{c(){e=p("button"),e.textContent="← タイトルへ",t=b(),i=p("video"),l=b(),r=p("canvas"),o=b(),a=p("div"),a.innerHTML='<span id="countdown-text" class="text-white text-9xl font-bold"></span>',c=b(),s=p("div"),s.innerHTML='<div id="stage-area" class="absolute top-0 left-0 w-full h-3/5 bg-gray-900 overflow-hidden flex justify-center items-end"><div class="w-full h-1/4 bg-black/30" style="perspective: 50px;"><div class="w-full h-full bg-gray-700" style="transform: rotateX(30deg);"></div></div> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[200%] h-[200px] bg-gradient-to-t from-purple-600/30 to-transparent rounded-[100%] animate-pulse"></div> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[150%] h-[150px] bg-gradient-to-t from-blue-500/40 to-transparent rounded-[100%]" style="animation-delay: 500ms;"></div></div> <div id="audience-area" class="absolute bottom-0 left-0 w-full h-2/5"></div>',u=b(),f=p("div"),_=p("div"),m=b(),g=p("div"),S=p("div"),S.textContent="Lyricほにゃらら",y=b(),E=p("div"),L=z(n[1]),A=b(),R=p("div"),$=p("div"),C=z(n[2]),v=b(),T=p("div"),I=z("コンボ: "),N=z(n[3]),M=b(),U=p("div"),P=z(O),F=b(),B=p("div"),ye(V.$$.fragment),Ce=b(),ye(ee.$$.fragment),Te=b(),ye(Q.$$.fragment),h(e,"class","fixed top-3 left-3 z-[2000] bg-gray-800/80 text-white px-4 py-2 rounded"),h(i,"id","camera-video"),h(i,"class","hidden"),h(r,"id","segmentation-canvas"),h(r,"class","fixed top-0 left-0 w-full h-full z-[1]"),h(a,"id","countdown-overlay"),h(a,"class","fixed top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-70 z-[1000] hidden"),h(s,"id","live-background"),h(s,"class","fixed top-0 left-0 w-full h-full z-[-1]"),h(_,"id","miku"),h(S,"id","song-title"),h(E,"id","loading"),h(g,"id","song-info"),h($,"id","score"),h(T,"id","combo"),h(R,"id","score-container"),h(U,"id","instructions"),h(B,"id","controls"),h(f,"id","game-container"),h(f,"class","relative")},m(k,H){x(k,e,H),x(k,t,H),x(k,i,H),x(k,l,H),x(k,r,H),x(k,o,H),x(k,a,H),x(k,c,H),x(k,s,H),x(k,u,H),x(k,f,H),d(f,_),d(f,m),d(f,g),d(g,S),d(g,y),d(g,E),d(E,L),d(f,A),d(f,R),d(R,$),d($,C),d(R,v),d(R,T),d(T,I),d(T,N),d(f,M),d(f,U),d(U,P),d(f,F),d(f,B),ue(V,B,null),x(k,Ce,H),ue(ee,k,H),x(k,Te,H),ue(Q,k,H),Z=!0,Se||(Ae=X(e,"click",n[7]),Se=!0)},p(k,[H]){(!Z||H&2)&&W(L,k[1]),(!Z||H&4)&&W(C,k[2]),(!Z||H&8)&&W(N,k[3]),(!Z||H&16)&&O!==(O=(k[4]||"歌詞の文字にマウスを当ててポイントを獲得しよう！")+"")&&W(P,O)},i(k){Z||(K(V.$$.fragment,k),K(ee.$$.fragment,k),K(Q.$$.fragment,k),Z=!0)},o(k){ie(V.$$.fragment,k),ie(ee.$$.fragment,k),ie(Q.$$.fragment,k),Z=!1},d(k){k&&(w(e),w(t),w(i),w(l),w(r),w(o),w(a),w(c),w(s),w(u),w(f),w(Ce),w(Te)),fe(V),fe(ee,k),fe(Q,k),Se=!1,Ae()}}}function Dt(n,e,t){let i,l,r,o,a;J(n,ge,y=>t(1,i=y)),J(n,ae,y=>t(2,l=y)),J(n,ce,y=>t(3,r=y)),J(n,Ee,y=>t(4,o=y)),J(n,j,y=>t(5,a=y));const c=ve();let s;return Ze(async()=>{const y="/star/";if(window.__BASE_URL=y,!document.getElementById("game-styles-link")){const v=document.createElement("link");v.id="game-styles-link",v.rel="stylesheet",v.href=`${y}styles.css`,document.head.appendChild(v)}const[E]=await Promise.all([pe(()=>import("./index.es-D3Oys71N.js"),[])]);window.TextAliveApp={Player:E.Player};const R=JSON.parse(localStorage.getItem("selectedSong")||"null")||{id:1,title:"SUPERHERO",artist:"めろくる",apiToken:"wifkp8ak1TEhQ8pI",songUrl:"https://piapro.jp/t/hZ35/20240130103028"},C=new URLSearchParams(location.search).get("mode")||"cursor";t(0,s=new zt),s.init(R,C)}),[s,i,l,r,o,a,c,()=>c("back"),()=>a?s.play():s.pause(),()=>s.restart(),y=>s.clickBubble(y.detail.id),()=>window.location.href="index.html",()=>s.restart()]}class jt extends me{constructor(e){super(),he(this,e,Dt,Ft,se,{})}}function Nt(n){let e,t;return e=new jt({}),e.$on("back",n[3]),{c(){ye(e.$$.fragment)},m(i,l){ue(e,i,l),t=!0},p:D,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){fe(e,i)}}}function qt(n){let e,t;return e=new Et({}),e.$on("startGame",n[2]),{c(){ye(e.$$.fragment)},m(i,l){ue(e,i,l),t=!0},p:D,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){fe(e,i)}}}function Wt(n){let e,t,i,l;const r=[qt,Nt],o=[];function a(c,s){return c[0]==="index"?0:1}return e=a(n),t=o[e]=r[e](n),{c(){t.c(),i=rt()},m(c,s){o[e].m(c,s),x(c,i,s),l=!0},p(c,[s]){let u=e;e=a(c),e===u?o[e].p(c,s):(gt(),ie(o[u],1,1,()=>{o[u]=null}),_t(),t=o[e],t?t.p(c,s):(t=o[e]=r[e](c),t.c()),K(t,1),t.m(i.parentNode,i))},i(c){l||(K(t),l=!0)},o(c){ie(t),l=!1},d(c){c&&w(i),o[e].d(c)}}}function Gt(n,e,t){let i="index";i=new URLSearchParams(location.search).get("page")==="game"?"game":"index";function r(s){const u=new URL(location.href);s==="game"?u.searchParams.set("page","game"):u.searchParams.delete("page"),history.pushState({},"",u),t(0,i=s)}const o=()=>{const s=new URLSearchParams(location.search).get("page");t(0,i=s==="game"?"game":"index")};return window.addEventListener("popstate",o),[i,r,()=>r("game"),()=>r("index")]}class Vt extends me{constructor(e){super(),he(this,e,Gt,Wt,se,{})}}new Vt({target:document.getElementById("app")});export{pe as _};
