var je=Object.defineProperty;var Ee=(t,e,n)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var K=(t,e,n)=>Ee(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function B(){}function ye(t){return t()}function ce(){return Object.create(null)}function G(t){t.forEach(ye)}function xe(t){return typeof t=="function"}function Z(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Be(t){return Object.keys(t).length===0}function f(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function _(t){t.parentNode&&t.parentNode.removeChild(t)}function Se(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function _e(t){return document.createTextNode(t)}function x(){return _e(" ")}function Le(){return _e("")}function we(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function d(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Pe(t){return Array.from(t.childNodes)}function W(t,e){t.value=e??""}function de(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}function ue(t,e,n){for(let i=0;i<t.options.length;i+=1){const s=t.options[i];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Te(t){const e=t.querySelector(":checked");return e&&e.__value}function Me(t,e,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:i})}let R;function z(t){R=t}function $e(){if(!R)throw new Error("Function called outside component initialization");return R}function ee(t){$e().$$.on_mount.push(t)}function Oe(){const t=$e();return(e,n,{cancelable:i=!1}={})=>{const s=t.$$.callbacks[e];if(s){const o=Me(e,n,{cancelable:i});return s.slice().forEach(r=>{r.call(t,o)}),!o.defaultPrevented}return!0}}const I=[],fe=[];let N=[];const pe=[],Ae=Promise.resolve();let Q=!1;function Ue(){Q||(Q=!0,Ae.then(ke))}function F(t){N.push(t)}const V=new Set;let U=0;function ke(){if(U!==0)return;const t=R;do{try{for(;U<I.length;){const e=I[U];U++,z(e),Ie(e.$$)}}catch(e){throw I.length=0,U=0,e}for(z(null),I.length=0,U=0;fe.length;)fe.pop()();for(let e=0;e<N.length;e+=1){const n=N[e];V.has(n)||(V.add(n),n())}N.length=0}while(I.length);for(;pe.length;)pe.pop()();Q=!1,V.clear(),z(t)}function Ie(t){if(t.fragment!==null){t.update(),G(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(F)}}function Ne(t){const e=[],n=[];N.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),N=e}const q=new Set;let L;function He(){L={r:0,c:[],p:L}}function ze(){L.r||G(L.c),L=L.p}function D(t,e){t&&t.i&&(q.delete(t),t.i(e))}function Y(t,e,n,i){if(t&&t.o){if(q.has(t))return;q.add(t),L.c.push(()=>{q.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}function me(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Ce(t){t&&t.c()}function te(t,e,n){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),F(()=>{const o=t.$$.on_mount.map(ye).filter(xe);t.$$.on_destroy?t.$$.on_destroy.push(...o):G(o),t.$$.on_mount=[]}),s.forEach(F)}function ne(t,e){const n=t.$$;n.fragment!==null&&(Ne(n.after_update),G(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Re(t,e){t.$$.dirty[0]===-1&&(I.push(t),Ue(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ie(t,e,n,i,s,o,r=null,p=[-1]){const l=R;z(t);const a=t.$$={fragment:null,ctx:[],props:o,update:B,not_equal:s,bound:ce(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:ce(),dirty:p,skip_bound:!1,root:e.target||l.$$.root};r&&r(a.root);let u=!1;if(a.ctx=n?n(t,e.props||{},(c,m,...h)=>{const E=h.length?h[0]:m;return a.ctx&&s(a.ctx[c],a.ctx[c]=E)&&(!a.skip_bound&&a.bound[c]&&a.bound[c](E),u&&Re(t,c)),m}):[],a.update(),u=!0,G(a.before_update),a.fragment=i?i(a.ctx):!1,e.target){if(e.hydrate){const c=Pe(e.target);a.fragment&&a.fragment.l(c),c.forEach(_)}else a.fragment&&a.fragment.c();e.intro&&D(t.$$.fragment),te(t,e.target,e.anchor),ke()}z(l)}class se{constructor(){K(this,"$$");K(this,"$$set")}$destroy(){ne(this,1),this.$destroy=B}$on(e,n){if(!xe(n))return B;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!Be(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const De="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(De);function he(t,e,n){const i=t.slice();return i[8]=e[n],i}function ge(t){let e;return{c(){e=g("div"),e.textContent="モバイルではCursorモード固定です",d(e,"class","text-gray-300 text-sm mt-2")},m(n,i){$(n,e,i)},d(n){n&&_(e)}}}function ve(t){let e,n,i,s,o,r,p,l,a,u,c;function m(...h){return t[5](t[8],...h)}return{c(){e=g("li"),n=g("button"),i=g("div"),s=g("h3"),s.textContent=`${t[8].title}`,o=x(),r=g("p"),r.textContent=`${t[8].artist}`,p=x(),l=g("div"),l.textContent="プレイ",a=x(),d(s,"class","text-xl text-[#39C5BB] font-medium"),d(r,"class","text-white/70 text-sm"),d(l,"class","bg-[#39C5BB] text-white px-4 py-2 rounded-lg"),d(n,"class","w-full p-4 text-left flex justify-between items-center focus:outline-none"),d(e,"class","song-item bg-black/40 rounded-lg backdrop-blur-sm border border-[#39C5BB]/30")},m(h,E){$(h,e,E),f(e,n),f(n,i),f(i,s),f(i,o),f(i,r),f(n,p),f(n,l),f(e,a),u||(c=we(n,"click",m),u=!0)},p(h,E){t=h},d(h){h&&_(e),u=!1,c()}}}function Ge(t){let e,n,i,s,o,r,p,l,a,u,c,m,h,E,C,k,S,b,P,T,M,oe,le,J,H,X,re,j=t[1]&&ge(),O=me(t[2]),w=[];for(let v=0;v<O.length;v+=1)w[v]=ve(he(t,O,v));return{c(){e=g("div"),n=g("div"),i=x(),s=g("div"),o=x(),r=g("div"),p=x(),l=g("div"),a=x(),u=g("div"),c=g("div"),c.innerHTML='<h1 class="text-3xl xs:text-4xl sm:text-5xl md:text-6xl font-bold text-miku mb-2 tracking-wider">Lyric Stage</h1>',m=x(),h=g("div"),h.innerHTML='<p class="text-white/90 text-sm sm:text-base">歌詞の文字に触れてポイントを獲得しよう！</p>',E=x(),C=g("div"),k=g("label"),k.textContent="Playモード選択:",S=x(),b=g("select"),P=g("option"),P.textContent="Cursorモード",T=g("option"),T.textContent="Handモード（カメラ）",M=g("option"),M.textContent="Bodyモード（カメラ）",oe=x(),j&&j.c(),le=x(),J=g("div"),H=g("ul");for(let v=0;v<w.length;v+=1)w[v].c();d(n,"id","stars-container"),d(n,"class","fixed top-0 left-0 w-full h-full z-0"),d(s,"class","spotlight left-1/4 hidden sm:block"),d(r,"class","spotlight left-2/4 hidden sm:block"),de(r,"animation-delay","-3s"),d(l,"class","spotlight left-3/4 hidden sm:block"),de(l,"animation-delay","-6s"),d(c,"class","text-center mb-4 sm:mb-6"),d(h,"class","max-w-md mx-auto text-center mb-4 sm:mb-6 bg-black/30 p-2 sm:p-2 rounded-lg backdrop-blur-sm"),d(k,"for","game-mode"),d(k,"class","text-white mr-2 text-lg"),P.__value="cursor",W(P,P.__value),T.__value="hand",W(T,T.__value),M.__value="body",W(M,M.__value),d(b,"id","game-mode"),d(b,"class","p-2 rounded bg-gray-700 text-white text-lg"),b.disabled=t[1],t[0]===void 0&&F(()=>t[4].call(b)),d(C,"id","mode-selection"),d(C,"class","mt-4 mb-6 text-center"),d(H,"class","space-y-2 sm:space-y-3"),d(J,"class","max-w-lg w-full mx-auto"),d(u,"class","relative z-10 w-full max-w-xl flex flex-col items-center justify-center py-6 px-4 min-h-screen"),d(e,"class","bg-gradient-to-b from-gradientStart to-darkBg min-h-screen w-full text-white browser-bar-adjust flex justify-center items-center")},m(v,A){$(v,e,A),f(e,n),f(e,i),f(e,s),f(e,o),f(e,r),f(e,p),f(e,l),f(e,a),f(e,u),f(u,c),f(u,m),f(u,h),f(u,E),f(u,C),f(C,k),f(C,S),f(C,b),f(b,P),f(b,T),f(b,M),ue(b,t[0],!0),f(C,oe),j&&j.m(C,null),f(u,le),f(u,J),f(J,H);for(let y=0;y<w.length;y+=1)w[y]&&w[y].m(H,null);X||(re=we(b,"change",t[4]),X=!0)},p(v,[A]){if(A&2&&(b.disabled=v[1]),A&1&&ue(b,v[0]),v[1]?j||(j=ge(),j.c(),j.m(C,null)):j&&(j.d(1),j=null),A&12){O=me(v[2]);let y;for(y=0;y<O.length;y+=1){const ae=he(v,O,y);w[y]?w[y].p(ae,A):(w[y]=ve(ae),w[y].c(),w[y].m(H,null))}for(;y<w.length;y+=1)w[y].d(1);w.length=O.length}},i:B,o:B,d(v){v&&_(e),j&&j.d(),Se(w,v),X=!1,re()}}}function Je(){const t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e="ontouchstart"in window||navigator.maxTouchPoints>0,n=window.innerWidth<=768,i=/iPhone|iPad|iPod/i.test(navigator.userAgent);return t||e&&n||i}function be(){const t=document.getElementById("stars-container");if(!t)return;const e=Math.min(100,Math.floor(window.innerWidth*window.innerHeight/6e3));t.innerHTML="";const n=document.createDocumentFragment();for(let i=0;i<e;i++){const s=document.createElement("div");s.className="star",s.style.left=`${Math.random()*100}%`,s.style.top=`${Math.random()*100}%`,s.style.animationDelay=`${Math.random()*3}s`,Math.random()>.7&&(s.style.width="6px",s.style.height="6px",s.style.boxShadow="0 0 10px #fff"),n.appendChild(s)}t.appendChild(n)}function qe(t){const e=t.currentTarget??t.target;if(!e)return;const n=e.getBoundingClientRect(),i=document.createElement("div"),s=(t.clientX??n.left+n.width/2)-n.left,o=(t.clientY??n.top+n.height/2)-n.top;i.className="absolute bg-white/40 rounded-full pointer-events-none",i.style.width="100px",i.style.height="100px",i.style.left=`${s}px`,i.style.top=`${o}px`,i.style.transform="translate(-50%, -50%) scale(0)",i.style.animation="ripple 0.6s ease-out forwards",e.style.position="relative",e.style.overflow="hidden",e.appendChild(i),setTimeout(()=>i.remove(),650)}function Fe(t,e,n){Oe();const i=[{id:1,title:"ストリートライト",artist:"加賀(ネギシャワーP)",apiToken:"HmfsoBVch26BmLCm",songUrl:"https://piapro.jp/t/ULcJ/20250205120202"},{id:2,title:"アリフレーション",artist:"雨良 Amala",apiToken:"rdja5JxMEtcYmyKP",songUrl:"https://piapro.jp/t/SuQO/20250127235813"},{id:3,title:"インフォーマルダイブ",artist:"99piano",apiToken:"CqbpJNJHwoGvXhlD",songUrl:"https://piapro.jp/t/Ppc9/20241224135843"},{id:4,title:"ハロー、フェルミ。",artist:"ど～ぱみん",apiToken:"o1B1ZygOqyhK5B3D",songUrl:"https://piapro.jp/t/oTaJ/20250204234235"},{id:5,title:"パレードレコード",artist:"きさら",apiToken:"G8MU8Wf87RotH8OR",songUrl:"https://piapro.jp/t/GCgy/20250202202635"},{id:6,title:"ロンリーラン",artist:"海風太陽",apiToken:"fI0SyBEEBzlB2f5C",songUrl:"https://piapro.jp/t/CyPO/20250128183915"}];let s="cursor",o=!1;const r="/star/";function p(u){localStorage.setItem("selectedSong",JSON.stringify(u)),window.location.href=`${r}game.html?mode=${s}`}ee(()=>{const u=()=>new Promise(k=>{if(window.tailwind)return k();if(!document.getElementById("tw-config-inline")){const b=document.createElement("script");b.id="tw-config-inline",b.textContent="tailwind = { config: { theme: { extend: { colors: { miku: '#39C5BB', mikuDark: '#2AA198', mikuLight: '#7FDBCA', darkBg: '#090A0F', gradientStart: '#1B2735' }, animation: { float: 'float 3s ease-in-out infinite', 'pulse-miku': 'pulse-miku 2s cubic-bezier(0.4, 0, 0.6, 1) infinite' }, keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }, 'pulse-miku': { '0%, 100%': { opacity: 1, boxShadow: '0 0 20px 5px rgba(57, 197, 187, 0.7)' }, '50%': { opacity: 0.7, boxShadow: '0 0 10px 2px rgba(57, 197, 187, 0.3)' } } }, screens: { xs: '480px', '3xl': '1920px' } } } } };",document.head.appendChild(b)}const S=document.createElement("script");S.src="https://cdn.tailwindcss.com",S.onload=()=>k(),S.onerror=()=>k(),document.head.appendChild(S)}),c="/star/";if(!document.getElementById("index-styles-link")){const k=document.createElement("link");k.id="index-styles-link",k.rel="stylesheet",k.href=`${c}index-styles.css`,document.head.appendChild(k)}const m=document.body,h=["bg-gradient-to-b","from-gradientStart","to-darkBg","min-h-screen","w-full","text-white","browser-bar-adjust","flex","justify-center","items-center"];m.classList.add(...h),u().then(()=>{}),n(1,o=Je()),o&&n(0,s="cursor"),be();let E;const C=()=>{clearTimeout(E),E=setTimeout(be,250)};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),m.classList.remove(...h)}});function l(){s=Te(this),n(0,s)}return[s,o,i,p,l,(u,c)=>{qe(c),p(u)}]}class Ye extends se{constructor(e){super(),ie(this,e,Fe,Ge,Z,{})}}function Xe(t){let e,n,i,s,o,r,p,l,a,u,c;return{c(){e=g("video"),n=x(),i=g("canvas"),s=x(),o=g("div"),o.innerHTML='<span id="countdown-text" class="text-white text-9xl font-bold"></span>',r=x(),p=g("div"),p.innerHTML='<div id="stage-area" class="absolute top-0 left-0 w-full h-3/5 bg-gray-900 overflow-hidden flex justify-center items-end"><div class="w-full h-1/4 bg-black/30" style="perspective: 50px;"><div class="w-full h-full bg-gray-700" style="transform: rotateX(30deg);"></div></div> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[200%] h-[200px] bg-gradient-to-t from-purple-600/30 to-transparent rounded-[100%] animate-pulse"></div> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[150%] h-[150px] bg-gradient-to-t from-blue-500/40 to-transparent rounded-[100%]" style="animation-delay: 500ms;"></div></div> <div id="audience-area" class="absolute bottom-0 left-0 w-full h-2/5"></div>',l=x(),a=g("div"),a.innerHTML='<div id="miku"></div> <div id="song-info"><div id="song-title">Lyricほにゃらら</div> <div id="loading">ゲームをロード中...</div></div> <div id="score-container"><div id="score">0</div> <div id="combo">コンボ: 0</div></div> <div id="instructions">歌詞の文字にマウスを当ててポイントを獲得しよう！</div> <div id="controls"><button id="play-pause" aria-label="再生/一時停止">再生</button> <button id="restart" aria-label="最初から">最初から</button></div>',u=x(),c=g("div"),c.innerHTML='<div class="results-container"><h2>リザルト</h2> <div class="results-content"><div class="results-score-section"><div id="final-score-display">0</div> <div id="final-combo-display">最大コンボ: 0</div> <div id="rank-display">ランク: S</div></div></div> <div class="results-buttons"><button id="back-to-title">タイトルへ戻る</button> <button id="replay-song">もう一度プレイ</button></div></div>',d(e,"id","camera-video"),d(e,"class","hidden"),d(i,"id","segmentation-canvas"),d(i,"class","fixed top-0 left-0 w-full h-full z-[1]"),d(o,"id","countdown-overlay"),d(o,"class","fixed top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-70 z-[1000] hidden"),d(p,"id","live-background"),d(p,"class","fixed top-0 left-0 w-full h-full z-[-1]"),d(a,"id","game-container"),d(c,"id","results-screen"),d(c,"class","hidden")},m(m,h){$(m,e,h),$(m,n,h),$(m,i,h),$(m,s,h),$(m,o,h),$(m,r,h),$(m,p,h),$(m,l,h),$(m,a,h),$(m,u,h),$(m,c,h)},p:B,i:B,o:B,d(m){m&&(_(e),_(n),_(i),_(s),_(o),_(r),_(p),_(l),_(a),_(u),_(c))}}}function Ke(t){return ee(async()=>{const e="/star/";if(window.__BASE_URL=e,document.body.classList.add("browser-bar-adjust"),!document.getElementById("game-styles-link")){const i=document.createElement("link");i.id="game-styles-link",i.rel="stylesheet",i.href=`${e}styles.css`,document.head.appendChild(i)}const n=(i,s={})=>new Promise((o,r)=>{if(document.querySelector(`script[src="${i}"]`))return o();const p=document.createElement("script");p.src=i,p.onload=()=>o(),p.onerror=l=>r(l),Object.entries(s).forEach(([l,a])=>p.setAttribute(l,a)),document.body.appendChild(p)});try{await n("https://cdn.tailwindcss.com"),await n("https://unpkg.com/axios/dist/axios.min.js"),await n("https://unpkg.com/textalive-app-api/dist/index.js"),await n("https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"),await n("https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js",{crossorigin:"anonymous"}),await n("https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js",{crossorigin:"anonymous"}),await n("https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.min.js",{crossorigin:"anonymous"}),await n("https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js",{crossorigin:"anonymous"}),await n("https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js",{crossorigin:"anonymous"}),await n(`${e}game-loader.js`),await n(`${e}script.js`)}catch(i){console.error("Game scripts load failed",i)}}),[]}class We extends se{constructor(e){super(),ie(this,e,Ke,Xe,Z,{})}}function Ve(t){let e,n;return e=new We({}),e.$on("back",t[3]),{c(){Ce(e.$$.fragment)},m(i,s){te(e,i,s),n=!0},p:B,i(i){n||(D(e.$$.fragment,i),n=!0)},o(i){Y(e.$$.fragment,i),n=!1},d(i){ne(e,i)}}}function Qe(t){let e,n;return e=new Ye({}),e.$on("startGame",t[2]),{c(){Ce(e.$$.fragment)},m(i,s){te(e,i,s),n=!0},p:B,i(i){n||(D(e.$$.fragment,i),n=!0)},o(i){Y(e.$$.fragment,i),n=!1},d(i){ne(e,i)}}}function Ze(t){let e,n,i,s;const o=[Qe,Ve],r=[];function p(l,a){return l[0]==="index"?0:1}return e=p(t),n=r[e]=o[e](t),{c(){n.c(),i=Le()},m(l,a){r[e].m(l,a),$(l,i,a),s=!0},p(l,[a]){let u=e;e=p(l),e===u?r[e].p(l,a):(He(),Y(r[u],1,1,()=>{r[u]=null}),ze(),n=r[e],n?n.p(l,a):(n=r[e]=o[e](l),n.c()),D(n,1),n.m(i.parentNode,i))},i(l){s||(D(n),s=!0)},o(l){Y(n),s=!1},d(l){l&&_(i),r[e].d(l)}}}function et(t,e,n){let i="index";i=new URLSearchParams(location.search).get("page")==="game"?"game":"index";const o="/star/";function r(){location.replace(`${o}index.html`)}function p(c){try{const m=new URL(location.href);c==="game"?m.searchParams.set("page","game"):m.searchParams.delete("page"),history.pushState({},"",m),n(0,i=c)}catch(m){console.error("navigate failed, fallback to root",m),r()}}const l=()=>{try{const c=new URLSearchParams(location.search).get("page");n(0,i=c==="game"?"game":"index")}catch(c){console.error("popstate parse failed, fallback to root",c),r()}};return window.addEventListener("popstate",l),ee(()=>{i!=="index"&&i!=="game"&&r()}),[i,p,()=>p("game"),()=>p("index")]}class tt extends se{constructor(e){super(),ie(this,e,et,Ze,Z,{})}}new tt({target:document.getElementById("app")});
