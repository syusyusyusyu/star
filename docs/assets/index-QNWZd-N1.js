var Pe=Object.defineProperty;var je=(e,t,n)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var V=(e,t,n)=>je(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function B(){}function be(e){return e()}function ue(){return Object.create(null)}function R(e){e.forEach(be)}function ye(e){return typeof e=="function"}function Z(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Be(e){return Object.keys(e).length===0}function _(e,t){e.appendChild(t)}function g(e,t,n){e.insertBefore(t,n||null)}function h(e){e.parentNode&&e.parentNode.removeChild(e)}function Le(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function xe(e){return document.createTextNode(e)}function w(){return xe(" ")}function Se(){return xe("")}function ee(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function u(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ae(e){return Array.from(e.childNodes)}function X(e,t){e.value=t??""}function ce(e,t,n,i){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,"")}function de(e,t,n){for(let i=0;i<e.options.length;i+=1){const s=e.options[i];if(s.__value===t){s.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Fe(e){const t=e.querySelector(":checked");return t&&t.__value}function Me(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}let z;function N(e){z=e}function we(){if(!z)throw new Error("Function called outside component initialization");return z}function $e(e){we().$$.on_mount.push(e)}function Ce(){const e=we();return(t,n,{cancelable:i=!1}={})=>{const s=e.$$.callbacks[t];if(s){const o=Me(t,n,{cancelable:i});return s.slice().forEach(r=>{r.call(e,o)}),!o.defaultPrevented}return!0}}const O=[],fe=[];let U=[];const pe=[],De=Promise.resolve();let Y=!1;function Te(){Y||(Y=!0,De.then(ke))}function q(e){U.push(e)}const Q=new Set;let T=0;function ke(){if(T!==0)return;const e=z;do{try{for(;T<O.length;){const t=O[T];T++,N(t),Oe(t.$$)}}catch(t){throw O.length=0,T=0,t}for(N(null),O.length=0,T=0;fe.length;)fe.pop()();for(let t=0;t<U.length;t+=1){const n=U[t];Q.has(n)||(Q.add(n),n())}U.length=0}while(O.length);for(;pe.length;)pe.pop()();Y=!1,Q.clear(),N(e)}function Oe(e){if(e.fragment!==null){e.update(),R(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(q)}}function Ue(e){const t=[],n=[];U.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),U=t}const J=new Set;let S;function He(){S={r:0,c:[],p:S}}function Ne(){S.r||R(S.c),S=S.p}function I(e,t){e&&e.i&&(J.delete(e),e.i(t))}function K(e,t,n,i){if(e&&e.o){if(J.has(e))return;J.add(e),S.c.push(()=>{J.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function me(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ee(e){e&&e.c()}function te(e,t,n){const{fragment:i,after_update:s}=e.$$;i&&i.m(t,n),q(()=>{const o=e.$$.on_mount.map(be).filter(ye);e.$$.on_destroy?e.$$.on_destroy.push(...o):R(o),e.$$.on_mount=[]}),s.forEach(q)}function ne(e,t){const n=e.$$;n.fragment!==null&&(Ue(n.after_update),R(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ze(e,t){e.$$.dirty[0]===-1&&(O.push(e),Te(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ie(e,t,n,i,s,o,r=null,v=[-1]){const a=z;N(e);const l=e.$$={fragment:null,ctx:[],props:o,update:B,not_equal:s,bound:ue(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:ue(),dirty:v,skip_bound:!1,root:t.target||a.$$.root};r&&r(l.root);let c=!1;if(l.ctx=n?n(e,t.props||{},(f,E,...y)=>{const b=y.length?y[0]:E;return l.ctx&&s(l.ctx[f],l.ctx[f]=b)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](b),c&&ze(e,f)),E}):[],l.update(),c=!0,R(l.before_update),l.fragment=i?i(l.ctx):!1,t.target){if(t.hydrate){const f=Ae(t.target);l.fragment&&l.fragment.l(f),f.forEach(h)}else l.fragment&&l.fragment.c();t.intro&&I(e.$$.fragment),te(e,t.target,t.anchor),ke()}N(a)}class se{constructor(){V(this,"$$");V(this,"$$set")}$destroy(){ne(this,1),this.$destroy=B}$on(t,n){if(!ye(n))return B;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(t){this.$$set&&!Be(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ie="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ie);function he(e,t,n){const i=e.slice();return i[7]=t[n],i}function ge(e){let t;return{c(){t=d("div"),t.textContent="モバイルではCursorモード固定です",u(t,"class","text-gray-300 text-sm mt-2")},m(n,i){g(n,t,i)},d(n){n&&h(t)}}}function ve(e){let t,n,i,s,o,r,v,a,l,c,f;function E(){return e[5](e[7])}return{c(){t=d("li"),n=d("button"),i=d("div"),s=d("h3"),s.textContent=`${e[7].title}`,o=w(),r=d("p"),r.textContent=`${e[7].artist}`,v=w(),a=d("div"),a.textContent="プレイ",l=w(),u(s,"class","text-xl text-[#39C5BB] font-medium"),u(r,"class","text-white/70 text-sm"),u(a,"class","bg-[#39C5BB] text-white px-4 py-2 rounded-lg"),u(n,"class","w-full p-4 text-left flex justify-between items-center focus:outline-none"),u(t,"class","song-item bg-black/40 rounded-lg backdrop-blur-sm border border-[#39C5BB]/30")},m(y,b){g(y,t,b),_(t,n),_(n,i),_(i,s),_(i,o),_(i,r),_(n,v),_(n,a),_(t,l),c||(f=ee(n,"click",E),c=!0)},p(y,b){e=y},d(y){y&&h(t),c=!1,f()}}}function Re(e){let t,n,i,s,o,r,v,a,l,c,f,E,y,b,L,x,p,A,F,M,le,oe,G,H,W,re,P=e[1]&&ge(),D=me(e[2]),C=[];for(let m=0;m<D.length;m+=1)C[m]=ve(he(e,D,m));return{c(){t=d("div"),n=w(),i=d("div"),s=w(),o=d("div"),r=w(),v=d("div"),a=w(),l=d("div"),c=d("div"),c.innerHTML='<h1 class="text-3xl xs:text-4xl sm:text-5xl md:text-6xl font-bold text-miku mb-2 tracking-wider">Lyric Stage</h1>',f=w(),E=d("div"),E.innerHTML='<p class="text-white/90 text-sm sm:text-base">歌詞の文字に触れてポイントを獲得しよう！</p>',y=w(),b=d("div"),L=d("label"),L.textContent="Playモード選択:",x=w(),p=d("select"),A=d("option"),A.textContent="Cursorモード",F=d("option"),F.textContent="Handモード",M=d("option"),M.textContent="Bodyモード",le=w(),P&&P.c(),oe=w(),G=d("div"),H=d("ul");for(let m=0;m<C.length;m+=1)C[m].c();u(t,"id","stars-container"),u(t,"class","fixed top-0 left-0 w-full h-full z-0"),u(i,"class","spotlight left-1/4 hidden sm:block svelte-1fx20yu"),u(o,"class","spotlight left-2/4 hidden sm:block svelte-1fx20yu"),ce(o,"animation-delay","-3s"),u(v,"class","spotlight left-3/4 hidden sm:block svelte-1fx20yu"),ce(v,"animation-delay","-6s"),u(c,"class","text-center mb-4 sm:mb-6"),u(E,"class","max-w-md mx-auto text-center mb-4 sm:mb-6 bg-black/30 p-2 sm:p-2 rounded-lg backdrop-blur-sm"),u(L,"for","game-mode"),u(L,"class","text-white mr-2 text-lg"),A.__value="cursor",X(A,A.__value),F.__value="hand",X(F,F.__value),M.__value="body",X(M,M.__value),u(p,"id","game-mode"),u(p,"class","p-2 rounded bg-gray-700 text-white text-lg"),p.disabled=e[1],e[0]===void 0&&q(()=>e[4].call(p)),u(b,"id","mode-selection"),u(b,"class","mt-4 mb-6 text-center"),u(H,"class","space-y-2 sm:space-y-3"),u(G,"class","max-w-lg w-full mx-auto"),u(l,"class","relative z-10 w-full max-w-xl flex flex-col items-center justify-center py-6 px-4 min-h-screen text-white")},m(m,k){g(m,t,k),g(m,n,k),g(m,i,k),g(m,s,k),g(m,o,k),g(m,r,k),g(m,v,k),g(m,a,k),g(m,l,k),_(l,c),_(l,f),_(l,E),_(l,y),_(l,b),_(b,L),_(b,x),_(b,p),_(p,A),_(p,F),_(p,M),de(p,e[0],!0),_(b,le),P&&P.m(b,null),_(l,oe),_(l,G),_(G,H);for(let $=0;$<C.length;$+=1)C[$]&&C[$].m(H,null);W||(re=ee(p,"change",e[4]),W=!0)},p(m,[k]){if(k&2&&(p.disabled=m[1]),k&1&&de(p,m[0]),m[1]?P||(P=ge(),P.c(),P.m(b,null)):P&&(P.d(1),P=null),k&12){D=me(m[2]);let $;for($=0;$<D.length;$+=1){const ae=he(m,D,$);C[$]?C[$].p(ae,k):(C[$]=ve(ae),C[$].c(),C[$].m(H,null))}for(;$<C.length;$+=1)C[$].d(1);C.length=D.length}},i:B,o:B,d(m){m&&(h(t),h(n),h(i),h(s),h(o),h(r),h(v),h(a),h(l)),P&&P.d(),Le(C,m),W=!1,re()}}}function Ge(){const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t="ontouchstart"in window||navigator.maxTouchPoints>0,n=window.innerWidth<=768,i=/iPhone|iPad|iPod/i.test(navigator.userAgent);return e||t&&n||i}function _e(){const e=document.getElementById("stars-container");if(!e)return;const t=Math.min(100,Math.floor(window.innerWidth*window.innerHeight/6e3));e.innerHTML="";const n=document.createDocumentFragment();for(let i=0;i<t;i++){const s=document.createElement("div");s.className="star",s.style.left=`${Math.random()*100}%`,s.style.top=`${Math.random()*100}%`,s.style.animationDelay=`${Math.random()*3}s`,Math.random()>.7&&(s.style.width="6px",s.style.height="6px",s.style.boxShadow="0 0 10px #fff"),n.appendChild(s)}e.appendChild(n)}function Je(e,t,n){const i=Ce(),s=[{id:1,title:"ストリートライト",artist:"加賀(ネギシャワーP)",apiToken:"HmfsoBVch26BmLCm",songUrl:"https://piapro.jp/t/ULcJ/20250205120202"},{id:2,title:"アリフレーション",artist:"雨良 Amala",apiToken:"rdja5JxMEtcYmyKP",songUrl:"https://piapro.jp/t/SuQO/20250127235813"},{id:3,title:"インフォーマルダイブ",artist:"99piano",apiToken:"CqbpJNJHwoGvXhlD",songUrl:"https://piapro.jp/t/Ppc9/20241224135843"},{id:4,title:"ハロー、フェルミ。",artist:"ど～ぱみん",apiToken:"o1B1ZygOqyhK5B3D",songUrl:"https://piapro.jp/t/oTaJ/20250204234235"},{id:5,title:"パレードレコード",artist:"きさら",apiToken:"G8MU8Wf87RotH8OR",songUrl:"https://piapro.jp/t/GCgy/20250202202635"},{id:6,title:"ロンリーラン",artist:"海風太陽",apiToken:"fI0SyBEEBzlB2f5C",songUrl:"https://piapro.jp/t/CyPO/20250128183915"}];let o="cursor",r=!1;function v(c){localStorage.setItem("selectedSong",JSON.stringify(c));const f=new URL(location.href);f.searchParams.set("page","game"),f.searchParams.set("mode",o),history.pushState({},"",f),i("startGame")}$e(()=>{n(1,r=Ge()),r&&n(0,o="cursor"),_e();let c;const f=()=>{clearTimeout(c),c=setTimeout(_e,250)};return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)});function a(){o=Fe(this),n(0,o)}return[o,r,s,v,a,c=>v(c)]}class qe extends se{constructor(t){super(),ie(this,t,Je,Re,Z,{})}}function Ke(e){let t,n,i,s,o,r,v,a,l,c,f,E,y,b,L;return{c(){t=d("button"),t.textContent="← タイトルへ",n=w(),i=d("video"),s=w(),o=d("canvas"),r=w(),v=d("div"),v.innerHTML='<span id="countdown-text" class="text-white text-9xl font-bold"></span>',a=w(),l=d("div"),l.innerHTML='<div id="stage-area" class="absolute top-0 left-0 w-full h-3/5 bg-gray-900 overflow-hidden flex justify-center items-end"><div class="w-full h-1/4 bg-black/30" style="perspective: 50px;"><div class="w-full h-full bg-gray-700" style="transform: rotateX(30deg);"></div></div> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[200%] h-[200px] bg-gradient-to-t from-purple-600/30 to-transparent rounded-[100%] animate-pulse"></div> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[150%] h-[150px] bg-gradient-to-t from-blue-500/40 to-transparent rounded-[100%]" style="animation-delay: 500ms;"></div></div> <div id="audience-area" class="absolute bottom-0 left-0 w-full h-2/5"></div>',c=w(),f=d("div"),f.innerHTML='<div id="miku"></div> <div id="song-info"><div id="song-title">Lyricほにゃらら</div> <div id="loading">ゲームをロード中...</div></div> <div id="score-container"><div id="score">0</div> <div id="combo">コンボ: 0</div></div> <div id="instructions">歌詞の文字にマウスを当ててポイントを獲得しよう！</div> <div id="controls"><button id="play-pause" aria-label="再生/一時停止">再生</button> <button id="restart" aria-label="最初から">最初から</button></div>',E=w(),y=d("div"),y.innerHTML='<div class="results-container"><h2>リザルト</h2> <div class="results-content"><div class="results-score-section"><div id="final-score-display">0</div> <div id="final-combo-display">最大コンボ: 0</div> <div id="rank-display">ランク: S</div></div></div> <div class="results-buttons"><button id="back-to-title">タイトルへ戻る</button> <button id="replay-song">もう一度プレイ</button></div></div>',u(t,"class","fixed top-3 left-3 z-[2000] bg-gray-800/80 text-white px-4 py-2 rounded"),u(i,"id","camera-video"),u(i,"class","hidden"),u(o,"id","segmentation-canvas"),u(o,"class","fixed top-0 left-0 w-full h-full z-[1]"),u(v,"id","countdown-overlay"),u(v,"class","fixed top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-70 z-[1000] hidden"),u(l,"id","live-background"),u(l,"class","fixed top-0 left-0 w-full h-full z-[-1]"),u(f,"id","game-container"),u(y,"id","results-screen"),u(y,"class","hidden")},m(x,p){g(x,t,p),g(x,n,p),g(x,i,p),g(x,s,p),g(x,o,p),g(x,r,p),g(x,v,p),g(x,a,p),g(x,l,p),g(x,c,p),g(x,f,p),g(x,E,p),g(x,y,p),b||(L=ee(t,"click",e[1]),b=!0)},p:B,i:B,o:B,d(x){x&&(h(t),h(n),h(i),h(s),h(o),h(r),h(v),h(a),h(l),h(c),h(f),h(E),h(y)),b=!1,L()}}}function j(e){return new Promise((t,n)=>{const i=document.createElement("script");i.src=e,i.async=!0,i.onload=()=>t(),i.onerror=()=>n(new Error(`Failed to load ${e}`)),document.body.appendChild(i)})}function We(e){const t=Ce();return $e(async()=>{new URLSearchParams(location.search);try{const i="/star/";if(!document.getElementById("game-styles-link")){const s=document.createElement("link");s.id="game-styles-link",s.rel="stylesheet",s.href=`${i}styles.css`,document.head.appendChild(s)}await j("https://unpkg.com/axios/dist/axios.min.js"),await j("https://unpkg.com/textalive-app-api/dist/index.js"),await j("https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"),await j("https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"),await j("https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"),await j("https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.min.js"),await j("https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"),await j("https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"),await j(`${i}script.js`),await j(`${i}game-loader.js`)}catch(i){console.error(i)}}),[t,()=>t("back")]}class Ve extends se{constructor(t){super(),ie(this,t,We,Ke,Z,{})}}function Xe(e){let t,n;return t=new Ve({}),t.$on("back",e[3]),{c(){Ee(t.$$.fragment)},m(i,s){te(t,i,s),n=!0},p:B,i(i){n||(I(t.$$.fragment,i),n=!0)},o(i){K(t.$$.fragment,i),n=!1},d(i){ne(t,i)}}}function Qe(e){let t,n;return t=new qe({}),t.$on("startGame",e[2]),{c(){Ee(t.$$.fragment)},m(i,s){te(t,i,s),n=!0},p:B,i(i){n||(I(t.$$.fragment,i),n=!0)},o(i){K(t.$$.fragment,i),n=!1},d(i){ne(t,i)}}}function Ye(e){let t,n,i,s;const o=[Qe,Xe],r=[];function v(a,l){return a[0]==="index"?0:1}return t=v(e),n=r[t]=o[t](e),{c(){n.c(),i=Se()},m(a,l){r[t].m(a,l),g(a,i,l),s=!0},p(a,[l]){let c=t;t=v(a),t===c?r[t].p(a,l):(He(),K(r[c],1,1,()=>{r[c]=null}),Ne(),n=r[t],n?n.p(a,l):(n=r[t]=o[t](a),n.c()),I(n,1),n.m(i.parentNode,i))},i(a){s||(I(n),s=!0)},o(a){K(n),s=!1},d(a){a&&h(i),r[t].d(a)}}}function Ze(e,t,n){let i="index";i=new URLSearchParams(location.search).get("page")==="game"?"game":"index";function o(l){const c=new URL(location.href);l==="game"?c.searchParams.set("page","game"):c.searchParams.delete("page"),history.pushState({},"",c),n(0,i=l)}const r=()=>{const l=new URLSearchParams(location.search).get("page");n(0,i=l==="game"?"game":"index")};return window.addEventListener("popstate",r),[i,o,()=>o("game"),()=>o("index")]}class et extends se{constructor(t){super(),ie(this,t,Ze,Ye,Z,{})}}new et({target:document.getElementById("app")});
