# Lyricほにゃらら

## プロジェクト概要
このプロジェクトは、歌詞を表示して触れるリズムゲームです。
[TextAlive Player](https://textalive.jp/player/) を使用して歌詞のタイミングを音楽と同期させ、ユーザーが歌詞にインタラクトすることでスコアを獲得します。TextAlive API が利用できない場合は、簡易的なフォールバックモードで動作します。
[Three.js](https://threejs.org/) を使用してライブステージの3Dビジュアルを生成し、[MediaPipe Pose](https://google.github.io/mediapipe/solutions/pose.html) を使用したカメラベースのインタラクション（ペンライトの動きや全身検出）が特徴です。これにより、ユーザーはマウス、手、または全身を使ってゲームをプレイできます。

## セットアップと実行方法

### 1. ファイルの配置
プロジェクトのすべてのファイル（`game-loader.js`, `game.html`, `index-scripts.js`, `index-styles.css`, `index.html`, `script.js`, `styles.css`）を、ウェブサーバーのルートディレクトリまたは任意のディレクトリに配置します。

### 2. 依存関係
このプロジェクトは、以下の外部ライブラリをCDN経由で利用しています。特別なインストール作業（npm installなど）は不要です。

-   **TextAlive Player**: 音楽と歌詞の同期、再生制御
    -   `https://unpkg.com/textalive-app-sdk/dist/textalive-app-sdk.min.js`
-   **Three.js**: 3Dグラフィックス描画
    -   `https://cdnjs.cloudflare.com/ajax/libs/three.js/0.158.0/three.min.js`
-   **MediaPipe Pose**: 全身のポーズ推定
    -   `https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js`
-   **MediaPipe Hands**: 手の検出とランドマーク推定
    -   `https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js`
-   **MediaPipe Selfie Segmentation**: 背景除去
    -   `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js`

これらのライブラリは `index.html` および `game.html` 内で `<script src="...">` タグによって読み込まれます。

### 3. 実行
`index.html` をウェブブラウザで開いてください。ローカルファイルとして直接開くことも可能ですが、カメラアクセスや一部の機能が制限される場合があります。そのため、ローカルHTTPサーバーを使用することを強く推奨します。

#### ローカルHTTPサーバーの例:

**Node.js (http-server) の場合:**
```bash
# まず、http-serverをインストール（初回のみ）
npm install -g http-server
# プロジェクトルートディレクトリで実行
http-server -p 8000
# その後、ブラウザで http://localhost:8000/index.html にアクセス
```

**VS CodeのLive Server拡張機能:**
VS Codeを使用している場合、"Live Server" 拡張機能をインストールし、`index.html` を右クリックして "Open with Live Server" を選択すると、簡単にローカルサーバーを起動できます。

## 遊び方
1.  `index.html` をブラウザで開くと、ゲームのタイトル画面が表示されます。
2.  画面中央のボタンからプレイモードを選択します。
    *   **カーソルモード**: マウスカーソルまたはタッチで歌詞に触れます。
    *   **ハンドモード**: カメラに手を映し、指の動きで歌詞に触れます。
    *   **ボディモード**: カメラに全身を映し、体の動き（特に手）で歌詞に触れます。
3.  曲を選択し、「プレイ」ボタンをクリックしてゲーム画面へ進みます。
4.  ゲーム画面で「再生」ボタンをクリックすると音楽が開始され、歌詞が画面に表示されます。
    *   **ボディモードの場合**: ゲーム開始前に全身がカメラに映っていることを確認します。全身が検出されると5秒のカウントダウンが始まり、その後ゲームが開始されます。ゲーム中に全身が画面から3秒以上外れると警告メッセージが表示されます。
5.  表示された歌詞の文字に、選択したモードに応じた方法（マウスでクリック、指でタップ、または体で触れる）でインタラクトします。
6.  歌詞をヒットするとスコアが加算され、コンボが繋がります。
7.  **画面から消えるまでにヒットできなかった歌詞があると、コンボがリセットされます。**
8.  曲の終了後、自動的にリザルト画面が表示され、最終スコアとランクが確認できます。

## プロジェクト構造
-   `index.html`: ゲームの開始点となるメインHTMLファイル。タイトル画面、プレイモード選択、曲選択のUIを提供します。
-   `game.html`: 実際のゲームプレイ画面を表示するHTMLファイル。ゲームのメインロジックが実行されます。
-   `script.js`: ゲームの主要なJavaScriptロジックを定義するファイル。
    -   歌詞の表示、クリック判定、スコア・コンボ管理。
    -   TextAlive Player との連携による音楽と歌詞の同期。
    -   Three.js を用いた3Dライブステージのビジュアル管理。
    -   MediaPipe Pose/Hands を利用したカメラベースのインタラクション処理。
    -   各プレイモードの管理、全身検出とカウントダウンロジック。
-   `game-loader.js`: `game.html` でゲームをロードし、`GameManager` クラスを初期化するためのスクリプト。曲の設定などを `script.js` に渡します。
-   `styles.css`: ゲーム全体の基本的なスタイリングを定義するCSSファイル。ゲーム画面の要素（歌詞バブル、スコア表示など）や、3Dビジュアルの基本スタイルが含まれます。
-   `index-styles.css`: `index.html`（タイトル画面）専用のスタイリングを定義するCSSファイル。タイトルロゴ、ボタン、背景などのスタイルが含まれます。
-   `index-scripts.js`: `index.html`（タイトル画面）のJavaScriptロジックを定義するファイル。
    -   プレイモード選択と曲選択のUIインタラクション。
    -   選択されたモードと曲の情報を `game.html` に渡す処理。

## 使用技術
-   **HTML5**: ウェブページの構造とコンテンツを定義します。ゲームのUI要素やキャンバスなどが含まれます。
-   **CSS3**: ウェブページのスタイリングとレイアウトを定義します。アニメーション、レスポンシブデザイン、視覚効果などに利用されます。
-   **JavaScript (ES6+)**: ゲームのインタラクティブなロジックを実装します。DOM操作、イベント処理、外部ライブラリとの連携、ゲームの状態管理など、プロジェクトの核となる部分です。
-   **TextAlive Player**: 株式会社ドワンゴが提供する、音楽と歌詞を同期再生するためのJavaScriptライブラリ。歌詞のタイミング情報に基づいて、ゲーム内で歌詞を正確に表示・制御するために使用されます。
-   **Three.js**: ウェブブラウザ上で3Dグラフィックスを描画するためのJavaScriptライブラリ。ゲームのライブステージの背景、ペンライト、アバターなどの3Dビジュアルを構築・レンダリングするために利用されます。
-   **MediaPipe Pose**: Googleが提供する機械学習ソリューションで、カメラ映像からリアルタイムで全身のランドマーク（関節点）を推定します。本プロジェクトでは、ユーザーの全身の動きを検出し、ゲーム内のアバターを動かしたり、特定のポーズでインタラクションを発生させたりするために使用されます（CPU処理に最適化されています）。
-   **MediaPipe Hands**: MediaPipeの一部で、カメラ映像から手のランドマークを推定します。ハンドモードにおいて、ユーザーの手の動きを検出して歌詞へのインタラクションを可能にするために使用されます（CPU処理に最適化されています）。
-   **MediaPipe Selfie Segmentation**: MediaPipeの一部で、カメラ映像から人物のセグメンテーションマスク（背景と人物の分離）を生成します。本プロジェクトでは、ユーザーの背景をリアルタイムで除去し、ゲームの3Dステージにユーザーの姿だけを合成するために使用されます（CPU処理に最適化されています）。
